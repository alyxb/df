/*!
 * Tiny PowerPaste plugin
 *
 * Copyright (c) 2022 Ephox Corporation DBA Tiny Technologies, Inc.
 * Licensed under the Tiny commercial license. See https://www.tiny.cloud/legal/
 *
 * Version: 6.0.3-556
 */

!function(){"use strict";const e=e=>parseInt(e,10),t=(e,t)=>{const n=e-t;return 0===n?0:n>0?1:-1},n=(e,t,n)=>({major:e,minor:t,patch:n}),r=t=>{const r=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(t);return r?n(e(r[1]),e(r[2]),e(r[3])):n(0,0,0)},o=e=>t=>(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&((e,t,n)=>{var r,o;return o=e,!!t.prototype.isPrototypeOf(o)||(null===(r=e.constructor)||void 0===r?void 0:r.name)===t.name})(e,String)?"string":t})(t)===e,s=e=>t=>typeof t===e,a=o("string"),i=o("object"),l=o("array"),c=s("boolean"),m=(void 0,e=>undefined===e);const d=e=>null==e,u=e=>!d(e),p=s("function"),g=s("number"),f=()=>{},h=(e,t)=>(...n)=>e(t.apply(null,n)),v=e=>()=>e,y=e=>e,b=(e,t)=>e===t;function x(e,...t){return(...n)=>{const r=t.concat(n);return e.apply(null,r)}}const w=e=>()=>{throw new Error(e)},T=e=>e(),I=v(!1),S=v(!0);class O{constructor(e,t){this.tag=e,this.value=t}static some(e){return new O(!0,e)}static none(){return O.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?O.some(e(this.value)):O.none()}bind(e){return this.tag?e(this.value):O.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:O.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return u(e)?O.some(e):O.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}O.singletonNone=new O(!1);const E=Array.prototype.slice,N=Array.prototype.indexOf,k=Array.prototype.push,D=(e,t)=>((e,t)=>N.call(e,t))(e,t)>-1,A=(e,t)=>{for(let n=0,r=e.length;n<r;n++)if(t(e[n],n))return!0;return!1},C=(e,t)=>{const n=e.length,r=new Array(n);for(let o=0;o<n;o++){const n=e[o];r[o]=t(n,o)}return r},L=(e,t)=>{for(let n=0,r=e.length;n<r;n++)t(e[n],n)},_=(e,t)=>{const n=[],r=[];for(let o=0,s=e.length;o<s;o++){const s=e[o];(t(s,o)?n:r).push(s)}return{pass:n,fail:r}},R=(e,t)=>{const n=[];for(let r=0,o=e.length;r<o;r++){const o=e[r];t(o,r)&&n.push(o)}return n},P=(e,t,n)=>(L(e,((e,r)=>{n=t(n,e,r)})),n),M=(e,t)=>((e,t,n)=>{for(let r=0,o=e.length;r<o;r++){const o=e[r];if(t(o,r))return O.some(o);if(n(o,r))break}return O.none()})(e,t,I),F=(e,t)=>{for(let n=0,r=e.length;n<r;n++)if(t(e[n],n))return O.some(n);return O.none()},j=e=>{const t=[];for(let n=0,r=e.length;n<r;++n){if(!l(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);k.apply(t,e[n])}return t},H=(e,t)=>j(C(e,t)),U=(e,t)=>{for(let n=0,r=e.length;n<r;++n)if(!0!==t(e[n],n))return!1;return!0},z=(e,t)=>{const n={};for(let r=0,o=e.length;r<o;r++){const o=e[r];n[String(o)]=t(o,r)}return n},B=e=>((e,t)=>0<e.length?O.some(e[0]):O.none())(e),W=(e,t)=>{for(let n=0;n<e.length;n++){const r=t(e[n],n);if(r.isSome())return r}return O.none()},$=e=>t=>t.options.get(e),G=$("paste_as_text"),V=$("paste_merge_formats"),q=$("paste_tab_spaces"),K=$("smart_paste"),X=$("cache_suffix"),Y=$("automatic_uploads"),Z=$("indent_use_margin"),J=$("powerpaste_block_drop"),Q=$("powerpaste_keep_unsupported_src"),ee=$("powerpaste_allow_local_images"),te=$("powerpaste_word_import"),ne=$("powerpaste_googledocs_import"),re=$("powerpaste_html_import"),oe=$("powerpaste_clean_filtered_inline_elements"),se=e=>{var t;return tinymce.explode(null!==(t=e.options.get("images_file_types"))&&void 0!==t?t:"")},ae=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}},ie=()=>{const e=(e=>{const t=ae(O.none()),n=()=>t.get().each(e);return{clear:()=>{n(),t.set(O.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{n(),t.set(O.some(e))}}})(f);return{...e,on:t=>e.get().each(t)}},le=(e,t,n)=>""===t||e.length>=t.length&&e.substr(n,n+t.length)===t,ce=(e,t)=>de(e,t)?((e,t)=>e.substring(t))(e,t.length):e,me=(e,t)=>-1!==e.indexOf(t),de=(e,t)=>le(e,t,0),ue=(e,t)=>le(e,t,e.length-t.length),pe=(ge=/^\s+|\s+$/g,e=>e.replace(ge,""));var ge;const fe=(e,t)=>{const n=t=>e(t)?O.from(t.dom.nodeValue):O.none();return{get:r=>{if(!e(r))throw new Error("Can only get "+t+" value of a "+t+" node");return n(r).getOr("")},getOption:n,set:(n,r)=>{if(!e(n))throw new Error("Can only set raw "+t+" value of a "+t+" node");n.dom.nodeValue=r}}},he="undefined"!=typeof window?window:Function("return this;")(),ve=(e,t)=>(void 0!==e[t]&&null!==e[t]||(e[t]={}),e[t]),ye=(e,t)=>((e,t)=>{let n=void 0!==t?t:he;for(let t=0;t<e.length;++t)n=ve(n,e[t]);return n})(e.split("."),t),be=e=>e.dom.nodeName.toLowerCase(),xe=e=>e.dom.nodeType,we=e=>t=>xe(t)===e,Te=e=>8===xe(e)||"#comment"===be(e),Ie=we(1),Se=we(3),Oe=we(9),Ee=we(11),Ne=e=>t=>Ie(t)&&be(t)===e,ke=fe(Te,"comment"),De=e=>ke.get(e),Ae=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},Ce={fromHtml:(e,t)=>{const n=(t||document).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||n.childNodes.length>1){const t="HTML does not have a single root node";throw console.error(t,e),new Error(t)}return Ae(n.childNodes[0])},fromTag:(e,t)=>{const n=(t||document).createElement(e);return Ae(n)},fromText:(e,t)=>{const n=(t||document).createTextNode(e);return Ae(n)},fromDom:Ae,fromPoint:(e,t,n)=>O.from(e.dom.elementFromPoint(t,n)).map(Ae)},Le=e=>{let t,n=!1;return(...r)=>(n||(n=!0,t=e.apply(null,r)),t)},_e=()=>Re(0,0),Re=(e,t)=>({major:e,minor:t}),Pe={nu:Re,detect:(e,t)=>{const n=String(t).toLowerCase();return 0===e.length?_e():((e,t)=>{const n=((e,t)=>{for(let n=0;n<e.length;n++){const r=e[n];if(r.test(t))return r}})(e,t);if(!n)return{major:0,minor:0};const r=e=>Number(t.replace(n,"$"+e));return Re(r(1),r(2))})(e,n)},unknown:_e},Me=(e,t)=>{const n=String(t).toLowerCase();return M(e,(e=>e.search(n)))},Fe=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,je=e=>t=>me(t,e),He=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:e=>me(e,"edge/")&&me(e,"chrome")&&me(e,"safari")&&me(e,"applewebkit")},{name:"Chromium",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Fe],search:e=>me(e,"chrome")&&!me(e,"chromeframe")},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:e=>me(e,"msie")||me(e,"trident")},{name:"Opera",versionRegexes:[Fe,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:je("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:je("firefox")},{name:"Safari",versionRegexes:[Fe,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:e=>(me(e,"safari")||me(e,"mobile/"))&&me(e,"applewebkit")}],Ue=[{name:"Windows",search:je("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:e=>me(e,"iphone")||me(e,"ipad"),versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:je("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"macOS",search:je("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:je("linux"),versionRegexes:[]},{name:"Solaris",search:je("sunos"),versionRegexes:[]},{name:"FreeBSD",search:je("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:je("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],ze={browsers:v(He),oses:v(Ue)},Be="Edge",We="Chromium",$e="Opera",Ge="Firefox",Ve="Safari",qe=e=>{const t=e.current,n=e.version,r=e=>()=>t===e;return{current:t,version:n,isEdge:r(Be),isChromium:r(We),isIE:r("IE"),isOpera:r($e),isFirefox:r(Ge),isSafari:r(Ve)}},Ke=()=>qe({current:void 0,version:Pe.unknown()}),Xe=qe,Ye=(v(Be),v(We),v("IE"),v($e),v(Ge),v(Ve),"Windows"),Ze="Android",Je="Linux",Qe="macOS",et="Solaris",tt="FreeBSD",nt="ChromeOS",rt=e=>{const t=e.current,n=e.version,r=e=>()=>t===e;return{current:t,version:n,isWindows:r(Ye),isiOS:r("iOS"),isAndroid:r(Ze),isMacOS:r(Qe),isLinux:r(Je),isSolaris:r(et),isFreeBSD:r(tt),isChromeOS:r(nt)}},ot=()=>rt({current:void 0,version:Pe.unknown()}),st=rt,at=(v(Ye),v("iOS"),v(Ze),v(Je),v(Qe),v(et),v(tt),v(nt),e=>window.matchMedia(e).matches);let it=Le((()=>((e,t,n)=>{const r=ze.browsers(),o=ze.oses(),s=t.bind((e=>((e,t)=>W(t.brands,(t=>{const n=t.brand.toLowerCase();return M(e,(e=>{var t;return n===(null===(t=e.brand)||void 0===t?void 0:t.toLowerCase())})).map((e=>({current:e.name,version:Pe.nu(parseInt(t.version,10),0)})))})))(r,e))).orThunk((()=>((e,t)=>Me(e,t).map((e=>{const n=Pe.detect(e.versionRegexes,t);return{current:e.name,version:n}})))(r,e))).fold(Ke,Xe),a=((e,t)=>Me(e,t).map((e=>{const n=Pe.detect(e.versionRegexes,t);return{current:e.name,version:n}})))(o,e).fold(ot,st),i=((e,t,n,r)=>{const o=e.isiOS()&&!0===/ipad/i.test(n),s=e.isiOS()&&!o,a=e.isiOS()||e.isAndroid(),i=a||r("(pointer:coarse)"),l=o||!s&&a&&r("(min-device-width:768px)"),c=s||a&&!l,m=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(n),d=!c&&!l&&!m;return{isiPad:v(o),isiPhone:v(s),isTablet:v(l),isPhone:v(c),isTouch:v(i),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:v(m),isDesktop:v(d)}})(a,s,e,n);return{browser:s,os:a,deviceType:i}})(navigator.userAgent,O.from(navigator.userAgentData),at)));const lt=()=>it(),ct=lt(),mt=ct.deviceType.isiOS()||ct.deviceType.isAndroid(),dt=v({isSupported:!1,cleanDocument:()=>Promise.reject("not supported")});var ut=mt?dt:(e,t,n)=>{const r=t+"/wordimport.js"+(e=>O.from(e).filter((e=>0!==e.length)).map((e=>(-1===e.indexOf("?")?"?":"")+e)).getOr(""))(n||"v=9.0.1"),o=e.loadScript("ephox.wimp",r);return o.catch((e=>{console.error("Unable to load word import: ",e)})),{isSupported:!0,cleanDocument:(e,t,n)=>o.then((r=>r.cleanDocument(e,t,n.cleanFilteredInlineElements)))}};const pt=e=>{let t=[];return{bind:e=>{if(void 0===e)throw new Error("Event bind error: undefined handler");t.push(e)},unbind:e=>{t=R(t,(t=>t!==e))},trigger:(...n)=>{const r={};L(e,((e,t)=>{r[e]=n[t]})),L(t,(e=>{e(r)}))}}},gt=Object.keys,ft=Object.hasOwnProperty,ht=(e,t)=>{const n=gt(e);for(let r=0,o=n.length;r<o;r++){const o=n[r];t(e[o],o)}},vt=(e,t)=>yt(e,((e,n)=>({k:n,v:t(e,n)}))),yt=(e,t)=>{const n={};return ht(e,((e,r)=>{const o=t(e,r);n[o.k]=o.v})),n},bt=(e,t)=>{const n={};return((e,t,n,r)=>{ht(e,((e,o)=>{(t(e,o)?n:r)(e,o)}))})(e,t,(e=>(t,n)=>{e[n]=t})(n),f),n},xt=e=>gt(e).length,wt=(e,t)=>ft.call(e,t),Tt=e=>{const t=vt(e,(e=>({bind:e.bind,unbind:e.unbind}))),n=vt(e,(e=>e.trigger));return{registry:t,trigger:n}},It=(e,t)=>{const n=e.dom;if(1!==n.nodeType)return!1;{const e=n;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}},St=e=>1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType||0===e.childElementCount,Ot=(e,t)=>{const n=void 0===t?document:t.dom;return St(n)?[]:C(n.querySelectorAll(e),Ce.fromDom)},Et=(e,t)=>e.dom===t.dom,Nt=It,kt=(e,t,n)=>{const r=e.document.createRange();var o;return o=r,t.fold((e=>{o.setStartBefore(e.dom)}),((e,t)=>{o.setStart(e.dom,t)}),(e=>{o.setStartAfter(e.dom)})),((e,t)=>{t.fold((t=>{e.setEndBefore(t.dom)}),((t,n)=>{e.setEnd(t.dom,n)}),(t=>{e.setEndAfter(t.dom)}))})(r,n),r},Dt=(e,t,n,r,o)=>{const s=e.document.createRange();return s.setStart(t.dom,n),s.setEnd(r.dom,o),s},At=e=>{if(!l(e))throw new Error("cases must be an array");if(0===e.length)throw new Error("there must be at least one case");const t=[],n={};return L(e,((r,o)=>{const s=gt(r);if(1!==s.length)throw new Error("one and only one name per case");const a=s[0],i=r[a];if(void 0!==n[a])throw new Error("duplicate key detected:"+a);if("cata"===a)throw new Error("cannot have a case named cata (sorry)");if(!l(i))throw new Error("case arguments must be an array");t.push(a),n[a]=(...n)=>{const r=n.length;if(r!==i.length)throw new Error("Wrong number of arguments to case "+a+". Expected "+i.length+" ("+i+"), got "+r);return{fold:(...t)=>{if(t.length!==e.length)throw new Error("Wrong number of arguments to fold. Expected "+e.length+", got "+t.length);return t[o].apply(null,n)},match:e=>{const r=gt(e);if(t.length!==r.length)throw new Error("Wrong number of arguments to match. Expected: "+t.join(",")+"\nActual: "+r.join(","));if(!U(t,(e=>D(r,e))))throw new Error("Not all branches were specified when using match. Specified: "+r.join(", ")+"\nRequired: "+t.join(", "));return e[a].apply(null,n)},log:e=>{console.log(e,{constructors:t,constructor:a,params:n})}}}})),n},Ct=At([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),Lt=(e,t,n)=>t(Ce.fromDom(n.startContainer),n.startOffset,Ce.fromDom(n.endContainer),n.endOffset);Ct.ltr,Ct.rtl;const _t=(e,t,n,r)=>({start:e,soffset:t,finish:n,foffset:r}),Rt=e=>Ce.fromDom(e.dom.ownerDocument),Pt=e=>Oe(e)?e:Rt(e),Mt=e=>Ce.fromDom(Pt(e).dom.defaultView),Ft=e=>O.from(e.dom.parentNode).map(Ce.fromDom),jt=e=>O.from(e.dom.previousSibling).map(Ce.fromDom),Ht=e=>O.from(e.dom.nextSibling).map(Ce.fromDom),Ut=e=>(e=>{const t=E.call(e,0);return t.reverse(),t})(((e,t)=>{const n=[],r=e=>(n.push(e),t(e));let o=t(e);do{o=o.bind(r)}while(o.isSome());return n})(e,jt)),zt=e=>C(e.dom.childNodes,Ce.fromDom),Bt=p(Element.prototype.attachShadow)&&p(Node.prototype.getRootNode),Wt=v(Bt),$t=Bt?e=>Ce.fromDom(e.dom.getRootNode()):Pt,Gt=e=>Ce.fromDom(e.dom.host),Vt=e=>{const t=Se(e)?e.dom.parentNode:e.dom;if(null==t||null===t.ownerDocument)return!1;const n=t.ownerDocument;return(e=>{const t=$t(e);return Ee(n=t)&&u(n.dom.host)?O.some(t):O.none();var n})(Ce.fromDom(t)).fold((()=>n.body.contains(t)),(r=Vt,o=Gt,e=>r(o(e))));var r,o},qt=(e,t)=>{let n=[];return L(zt(e),(e=>{t(e)&&(n=n.concat([e])),n=n.concat(qt(e,t))})),n},Kt=(e,t)=>Ot(t,e),Xt=At([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Yt={before:Xt.before,on:Xt.on,after:Xt.after,cata:(e,t,n,r)=>e.fold(t,n,r),getStart:e=>e.fold(y,y,y)},Zt=At([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Jt={domRange:Zt.domRange,relative:Zt.relative,exact:Zt.exact,exactFromRange:e=>Zt.exact(e.start,e.soffset,e.finish,e.foffset),getWin:e=>{const t=(e=>e.match({domRange:e=>Ce.fromDom(e.startContainer),relative:(e,t)=>Yt.getStart(e),exact:(e,t,n,r)=>e}))(e);return Mt(t)},range:_t},Qt=(e,t)=>{const n=be(e);return"input"===n?Yt.after(e):D(["br","img"],n)?0===t?Yt.before(e):Yt.after(e):Yt.on(e,t)},en=(e,t,n,r)=>{const o=Rt(e).dom.createRange();return o.setStart(e.dom,t),o.setEnd(n.dom,r),o},tn=e=>O.from(e.getSelection()),nn=(e,t,n,r,o)=>{((e,t)=>{tn(e).each((e=>{e.removeAllRanges(),e.addRange(t)}))})(e,Dt(e,t,n,r,o))},rn=(e,t,n,r,o)=>{const s=((e,t,n,r)=>{const o=Qt(e,t),s=Qt(n,r);return Jt.relative(o,s)})(t,n,r,o);((e,t)=>{((e,t)=>{const n=((e,t)=>t.match({domRange:e=>({ltr:v(e),rtl:O.none}),relative:(t,n)=>({ltr:Le((()=>kt(e,t,n))),rtl:Le((()=>O.some(kt(e,n,t))))}),exact:(t,n,r,o)=>({ltr:Le((()=>Dt(e,t,n,r,o))),rtl:Le((()=>O.some(Dt(e,r,o,t,n))))})}))(e,t);return((e,t)=>{const n=t.ltr();return n.collapsed?t.rtl().filter((e=>!1===e.collapsed)).map((e=>Ct.rtl(Ce.fromDom(e.endContainer),e.endOffset,Ce.fromDom(e.startContainer),e.startOffset))).getOrThunk((()=>Lt(0,Ct.ltr,n))):Lt(0,Ct.ltr,n)})(0,n)})(e,t).match({ltr:(t,n,r,o)=>{nn(e,t,n,r,o)},rtl:(t,n,r,o)=>{tn(e).each((s=>{if(s.setBaseAndExtent)s.setBaseAndExtent(t.dom,n,r.dom,o);else if(s.extend)try{((e,t,n,r,o,s)=>{t.collapse(n.dom,r),t.extend(o.dom,s)})(0,s,t,n,r,o)}catch(s){nn(e,r,o,t,n)}else nn(e,r,o,t,n)}))}})})(e,s)},on=e=>{if(e.rangeCount>0){const t=e.getRangeAt(0),n=e.getRangeAt(e.rangeCount-1);return O.some(_t(Ce.fromDom(t.startContainer),t.startOffset,Ce.fromDom(n.endContainer),n.endOffset))}return O.none()},sn=e=>{if(null===e.anchorNode||null===e.focusNode)return on(e);{const t=Ce.fromDom(e.anchorNode),n=Ce.fromDom(e.focusNode);return((e,t,n,r)=>{const o=en(e,t,n,r),s=Et(e,n)&&t===r;return o.collapsed&&!s})(t,e.anchorOffset,n,e.focusOffset)?O.some(_t(t,e.anchorOffset,n,e.focusOffset)):on(e)}},an=e=>tn(e).filter((e=>e.rangeCount>0)).bind(sn),ln=(e,t)=>{Ft(e).each((n=>{n.dom.insertBefore(t.dom,e.dom)}))},cn=(e,t)=>{Ht(e).fold((()=>{Ft(e).each((e=>{dn(e,t)}))}),(e=>{ln(e,t)}))},mn=(e,t)=>{(e=>((e,t)=>{const n=e.dom.childNodes;return O.from(n[0]).map(Ce.fromDom)})(e))(e).fold((()=>{dn(e,t)}),(n=>{e.dom.insertBefore(t.dom,n.dom)}))},dn=(e,t)=>{e.dom.appendChild(t.dom)},un=(e,t)=>{ln(e,t),dn(t,e)},pn=(e,t)=>{L(t,((n,r)=>{const o=0===r?e:t[r-1];cn(o,n)}))},gn=(e,t)=>{L(t,(t=>{dn(e,t)}))},fn=e=>{e.dom.textContent="",L(zt(e),(e=>{hn(e)}))},hn=e=>{const t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)},vn=e=>{const t=zt(e);t.length>0&&pn(e,t),hn(e)},yn=(e,t,n,r)=>{const o=Et(e,n)&&t===r;return{startContainer:v(e),startOffset:v(t),endContainer:v(n),endOffset:v(r),collapsed:v(o)}};let bn=0;const xn=e=>{const t=(new Date).getTime(),n=Math.floor(1e9*Math.random());return bn++,e+"_"+n+bn+String(t)},wn=(e,t,n)=>{if(!(a(n)||c(n)||g(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")},Tn=(e,t,n)=>{wn(e.dom,t,n)},In=(e,t)=>{const n=e.dom;ht(t,((e,t)=>{wn(n,t,e)}))},Sn=(e,t)=>{const n=e.dom.getAttribute(t);return null===n?void 0:n},On=(e,t)=>O.from(Sn(e,t)),En=(e,t)=>{const n=e.dom;return!(!n||!n.hasAttribute)&&n.hasAttribute(t)},Nn=(e,t)=>{e.dom.removeAttribute(t)},kn=(e,t)=>{const n=Sn(e,t);return void 0===n||""===n?[]:n.split(" ")},Dn=e=>void 0!==e.dom.classList,An=e=>kn(e,"class"),Cn=(e,t)=>{Dn(e)?e.dom.classList.add(t):((e,t)=>{((e,t,n)=>{const r=kn(e,t).concat([n]);Tn(e,t,r.join(" "))})(e,"class",t)})(e,t)},Ln=(e,t)=>{Dn(e)?e.dom.classList.remove(t):((e,t)=>{((e,t,n)=>{const r=R(kn(e,t),(e=>e!==n));r.length>0?Tn(e,t,r.join(" ")):Nn(e,t)})(e,"class",t)})(e,t),(e=>{0===(Dn(e)?e.dom.classList:An(e)).length&&Nn(e,"class")})(e)},_n=(e,t)=>Dn(e)&&e.dom.classList.contains(t),Rn=(e,t,n=b)=>e.exists((e=>n(e,t))),Pn=(e,t)=>e?O.some(t):O.none(),Mn=e=>void 0!==e.style&&p(e.style.getPropertyValue),Fn=(e,t,n)=>{if(!a(n))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);Mn(e)&&e.style.setProperty(t,n)},jn=(e,t)=>{Mn(e)&&e.style.removeProperty(t)},Hn=(e,t,n)=>{const r=e.dom;Fn(r,t,n)},Un=(e,t)=>{const n=e.dom;ht(t,((e,t)=>{Fn(n,t,e)}))},zn=(e,t)=>{const n=e.dom,r=window.getComputedStyle(n).getPropertyValue(t);return""!==r||Vt(e)?r:Bn(n,t)},Bn=(e,t)=>Mn(e)?e.style.getPropertyValue(t):"",Wn=(e,t)=>{const n=e.dom,r=Bn(n,t);return O.from(r).filter((e=>e.length>0))},$n=e=>{const t={},n=e.dom;if(Mn(n))for(let e=0;e<n.style.length;e++){const r=n.style.item(e);t[r]=n.style[r]}return t},Gn=(e,t)=>{const n=e.dom;jn(n,t),Rn(On(e,"style").map(pe),"")&&Nn(e,"style")},Vn=e=>"rtl"===zn(e,"direction")?"rtl":"ltr",qn=(e,t)=>{const n=(t||document).createElement("div");return n.innerHTML=e,zt(Ce.fromDom(n))},Kn=e=>e.dom.innerHTML,Xn=(e,t,n)=>{let r=e.dom;const o=p(n)?n:I;for(;r.parentNode;){r=r.parentNode;const e=Ce.fromDom(r);if(t(e))return O.some(e);if(o(e))break}return O.none()},Yn=(e,t)=>M(e.dom.childNodes,(e=>t(Ce.fromDom(e)))).map(Ce.fromDom),Zn=(e,t)=>{const n=e=>{for(let r=0;r<e.childNodes.length;r++){const o=Ce.fromDom(e.childNodes[r]);if(t(o))return O.some(o);const s=n(e.childNodes[r]);if(s.isSome())return s}return O.none()};return n(e.dom)},Jn=(e,t,n)=>Xn(e,(e=>It(e,t)),n),Qn=(e,t,n)=>((e,t,n,r,o)=>((e,t)=>It(e,t))(n,r)?O.some(n):p(o)&&o(n)?O.none():t(n,r,o))(0,Jn,e,t,n),er=e=>{const t=tr(e);return{resolve:e=>{const n=e.split(" ");return C(n,(e=>nr(t,e))).join(" ")}}},tr=e=>e.replace(/\./g,"-"),nr=(e,t)=>e+"-"+t,rr=er("ephox-sloth").resolve,or=v(rr("bin")),sr=["b","i","u","sub","sup","strike"],ar=or(),ir=ar+xn(""),lr=("-100000px","100000px",e=>"rtl"===Vn(e)?"100000px":"-100000px");const cr=(e,t)=>{const n=Ce.fromTag("div");var r;In(n,t),In(n,{contenteditable:"true","aria-hidden":"true"}),Un(n,{position:"fixed",top:"0px",width:"100px",height:"100px",overflow:"hidden",opacity:"0"}),r=n,L([ar,ir],(e=>{Cn(r,e)}));const o=e=>_n(e,ir);return{attach:e=>{fn(n),Hn(n,"left",lr(e)),dn(e,n)},focus:()=>{Jn(n,"body").each((t=>{e.toOff(t,n)}))},contents:()=>(((e,t)=>{Ht(e).filter(t).each((t=>{const n=zt(t);gn(e,n),hn(t)})),((e,t)=>{const n=zt(e);L(n,(e=>{t(e)&&((e,t)=>{const n=zt(e),r=Ce.fromTag("div",Rt(e).dom);gn(r,n),ln(e,r),hn(e)})(e)}))})(e,t),L(zt(e),(e=>{(e=>Ie(e)&&!e.dom.hasChildNodes()&&D(sr,be(e)))(e)&&hn(e)}))})(n,o),{elements:zt(n),html:Kn(n),offscreen:n}),container:v(n),detach:()=>{hn(n)}}},mr=e=>{const t=Et(e.start,e.finish)&&e.soffset===e.foffset;return{startContainer:v(e.start),startOffset:v(e.soffset),endContainer:v(e.finish),endOffset:v(e.foffset),collapsed:v(t)}},dr={set:(e,t)=>{rn(e,t.startContainer(),t.startOffset(),t.endContainer(),t.endOffset())},get:e=>an(e).map(mr)};var ur=e=>t=>{const n=Tt({after:pt(["container"])}),r=(e=>{const t=Ce.fromTag("br");let n=O.none();const r=e=>Mt(e).dom;return{cleanup:()=>{hn(t)},toOn:(t,o)=>{const s=r(o);n.each((n=>{const r=(e=>e.dom.childNodes.length)(t),o=Et(t,n.startContainer())&&r<n.startOffset()?r:n.startOffset(),a=Et(t,n.endContainer())&&r<n.endOffset()?r:n.endOffset(),i=yn(n.startContainer(),o,n.endContainer(),a);e.set(s,i)}))},toOff:(o,s)=>{const a=r(s);dn(s,t),n=e.get(a),e.set(a,yn(t,0,t,0))}}})(dr),o=((e,t,n)=>{const r=cr(e,n),o=()=>{e.cleanup();const t=r.contents();r.detach(),s.trigger.after(t.elements,t.html,r.container())},s=Tt({before:pt([]),after:pt(["elements","html","container"])}),a=f;return{instance:v((()=>{s.trigger.before(),r.attach(t),r.focus(),((e,t)=>{((e,t)=>{setTimeout(t,1)})(0,t)})(Rt(t),o)})),destroy:a,events:s.registry}})(r,t,e);return o.events.after.bind((e=>{r.toOn(t,e.container),n.trigger.after(e.container)})),{run:()=>{o.instance()()},events:n.registry}};const pr=e=>{let t=O.none(),n=[];const r=e=>{o()?s(e):n.push(e)},o=()=>t.isSome(),s=e=>{t.each((t=>{setTimeout((()=>{e(t)}),0)}))};return e((e=>{o()||(t=O.some(e),L(n,s),n=[])})),{get:r,map:e=>pr((t=>{r((n=>{t(e(n))}))})),isReady:o}},gr={nu:pr,pure:e=>pr((t=>{t(e)}))},fr=e=>{setTimeout((()=>{throw e}),0)},hr=e=>{const t=t=>{e().then(t,fr)};return{map:t=>hr((()=>e().then(t))),bind:t=>hr((()=>e().then((e=>t(e).toPromise())))),anonBind:t=>hr((()=>e().then((()=>t.toPromise())))),toLazy:()=>gr.nu(t),toCached:()=>{let t=null;return hr((()=>(null===t&&(t=e()),t)))},toPromise:e,get:t}},vr=e=>hr((()=>new Promise(e))),yr=e=>((e,t)=>t((t=>{const n=[];let r=0;0===e.length?t([]):L(e,((o,s)=>{o.get((o=>s=>{n[o]=s,r++,r>=e.length&&t(n)})(s))}))})))(e,vr),br=()=>{const e={};return{getOrSetIndexed:(t,n)=>(t=>void 0!==e[t])(t)?e[t]:((t,n)=>(e[t]=n,n))(t,n()),waitForLoad:()=>{const t=((e,t)=>{const n=[];return ht(e,((e,r)=>{n.push(t(e,r))})),n})(e,y);return yr(t)}}},xr=e=>{const t=t=>t(e),n=v(e),r=()=>o,o={tag:!0,inner:e,fold:(t,n)=>n(e),isValue:S,isError:I,map:t=>Tr.value(t(e)),mapError:r,bind:t,exists:t,forall:t,getOr:n,or:r,getOrThunk:n,orThunk:r,getOrDie:n,each:t=>{t(e)},toOptional:()=>O.some(e)};return o},wr=e=>{const t=()=>n,n={tag:!1,inner:e,fold:(t,n)=>t(e),isValue:I,isError:S,map:t,mapError:t=>Tr.error(t(e)),bind:t,exists:I,forall:S,getOr:y,or:y,getOrThunk:T,orThunk:T,getOrDie:w(String(e)),each:f,toOptional:O.none};return n},Tr={value:xr,error:wr,fromOption:(e,t)=>e.fold((()=>wr(t)),xr)},Ir=e=>{const t=Ce.fromDom((e=>{if(Wt()&&u(e.target)){const t=Ce.fromDom(e.target);if(Ie(t)&&u(t.dom.shadowRoot)&&e.composed&&e.composedPath){const t=e.composedPath();if(t)return B(t)}}return O.from(e.target)})(e).getOr(e.target)),n=()=>e.stopPropagation(),r=()=>e.preventDefault(),o=h(r,n);return((e,t,n,r,o,s,a)=>({target:e,x:t,y:n,stop:r,prevent:o,kill:s,raw:a}))(t,e.clientX,e.clientY,n,r,o,e)},Sr=(e,t,n,r)=>{e.dom.removeEventListener(t,n,r)},Or=S,Er=(e,t,n)=>((e,t,n,r)=>((e,t,n,r,o)=>{const s=((e,t)=>n=>{e(n)&&t(Ir(n))})(n,r);return e.dom.addEventListener(t,s,o),{unbind:x(Sr,e,t,s,o)}})(e,t,n,r,!1))(e,t,Or,n),Nr=(e=>{const t=x(ye,e);ye("callbacks",t());const n=(n,o)=>{const s=t(),a=(e=>{const t=void 0===e.count?0:e.count,n="callback_"+t;return e.count=t+1,n})(s);return s.callbacks[a]=(...e)=>{o||r(a),n(...e)},(t=>e+".callbacks."+t)(a)},r=e=>{const n=e.substring(e.lastIndexOf(".")+1),r=t();void 0!==r.callbacks[n]&&delete r.callbacks[n]};return{ephemeral:e=>n(e,!1),permanent:e=>n(e,!0),unregister:r}})("ephox.henchman.features"),kr=(e,t)=>gr.nu((n=>{const r=t=>{L(s,(e=>{e.unbind()})),n(t.fold((t=>Tr.error(t+'Unable to download editor stylesheets from "'+e+'"')),Tr.value))},o=((e,t)=>{const n=Ce.fromDom(document),r=Ce.fromTag("link",n.dom);return In(r,{rel:"stylesheet",type:"text/css",href:e}),((e,t)=>{const n=(e=>{const t=e.dom.head;if(null==t)throw new Error("Head is not available yet");return Ce.fromDom(t)})(e);dn(n,t)})(n,r),r})(e),s=[Er(o,"load",(e=>{(e=>{var t;try{const n=null===(t=e.target.dom.sheet)||void 0===t?void 0:t.cssRules;return i(n)&&0===n.length}catch(e){}return!1})(e)?r(Tr.error("")):t(r)})),Er(o,"error",x(r,Tr.error("")))]})),Dr=(()=>{const e=br(),t=()=>e.waitForLoad();return{preload:()=>{t().get(y)},addStylesheet:(t,n)=>e.getOrSetIndexed(t,(()=>kr(t,n))),addScript:(t,n)=>e.getOrSetIndexed(t,(()=>(e=>gr.nu((t=>{const n=()=>{o.unbind(),s.unbind()},r=Ce.fromTag("script");Tn(r,"src",e),Tn(r,"type","text/javascript"),Tn(r,"async","async"),Tn(r,"data-main",Nr.ephemeral((e=>{t(Tr.value(e))})));const o=Er(r,"error",(()=>{n(),t(Tr.error("Error loading external script tag "+e))})),s=Er(r,"load",n);dn(Ce.fromDom(document.head),r)})))(t).map(n))),waitForLoad:t}})(),Ar={loadScript:(e,t)=>new Promise(((e,n)=>{((e,t)=>Dr.addScript(e,t))(t,y).get((t=>{t.fold(n,e)}))}))},Cr=At([{error:["message"]},{paste:["elements","correlated"]},{cancel:[]},{incomplete:["elements","correlated","message"]}]),Lr=(e,t,n,r,o)=>e.fold(t,n,r,o),_r=Cr.error,Rr=Cr.paste,Pr=Cr.cancel,Mr=Cr.incomplete,Fr=["officeStyles","htmlStyles","gdocsStyles","isWord","isGoogleDocs","proxyBin","isInternal"],jr=(e,t)=>{const n={};return L(Fr,(r=>{t[r].or(e[r]).each((e=>{n[r]=e}))})),Hr(n)},Hr=e=>z(Fr,(t=>O.from(e[t]))),Ur=e=>({response:_r(e),bundle:Hr({})}),zr=e=>Promise.resolve(Ur(e)),Br={response:Pr(),bundle:Hr({})},Wr=e=>u(e.then),$r=(e,t,n,r)=>({steps:e,input:t,label:n,capture:r}),Gr=(e,t)=>{const n=jr(e.bundle,t.bundle),r=((e,t)=>Lr(e,O.none,O.none,O.none,((e,n,r)=>Lr(t,O.none,((e,t)=>O.some(Cr.incomplete(e,t,r))),O.none,O.none))).getOr(t))(e.response,t.response);return{response:r,bundle:n}},Vr=(e,t,n)=>{const r=()=>e,o=()=>{const r=n(t,e);return Wr(r)?r.then((t=>Gr(e,t))):Gr(e,r)};return Lr(e.response,r,o,r,o)},qr=(Kr=(e,t)=>t,(...e)=>{if(0===e.length)throw new Error("Can't merge zero objects");const t={};for(let n=0;n<e.length;n++){const r=e[n];for(const e in r)wt(r,e)&&(t[e]=Kr(t[e],r[e]))}return t});var Kr;const Xr=At([{starts:["value","f"]},{pattern:["regex","f"]},{contains:["value","f"]},{exact:["value","f"]},{all:[]},{not:["stringMatch"]}]),Yr=y,Zr=(e,t)=>e.fold(((e,n)=>0===n(t).indexOf(n(e))),((e,n)=>e.test(n(t))),((e,n)=>n(t).indexOf(n(e))>=0),((e,n)=>n(t)===n(e)),S,(e=>!Zr(e,t))),Jr={starts:Xr.starts,pattern:Xr.pattern,contains:Xr.contains,exact:Xr.exact,all:Xr.all,not:Xr.not,cata:(e,t,n,r,o,s,a)=>e.fold(t,n,r,o,s,a),matches:Zr,caseSensitive:Yr,caseInsensitive:e=>e.toLowerCase()},Qr=(e,t)=>{const n=be(e),r=t.name,o=void 0!==t.condition?t.condition:S;return Jr.matches(r,n)&&o(e)},eo=(e,t,n)=>{const r=(e=>{const t={},n=u(e)?e.split(";"):[];return L(n,(e=>{const n=e.split(":");2===n.length&&(t[pe(n[0])]=pe(n[1]))})),t})(e.dom.getAttribute("style")),o={};return L(t,(e=>{const t=r[e];void 0===t||n(t,e)||(o[e]=t)})),o},to=e=>{const t=gt(e);return C(t,(t=>t+": "+e[t])).join("; ")},no=["mso-list"],ro=(e,t)=>{const n=eo(e,no,t),r=((e,t)=>{const n=e.dom.style,r=d(n)?[]:n,o={};return L(r,(n=>{Wn(e,n).each((e=>{t(e,n)||(o[n]=e)}))})),o})(e,t);((e,t,n)=>{Tn(e,"style","");const r=xt(t),o=xt(n);if(0===r&&0===o)Nn(e,"style");else if(0===r)Tn(e,"style",to(n));else{ht(t,((t,n)=>{Hn(e,n,t)}));const r=Sn(e,"style"),s=o>0?to(n)+"; ":"";Tn(e,"style",s+r)}})(e,r,n)},oo=(e,t)=>{const n=((e,t)=>{const n={};return L(e.dom.attributes,(e=>{t(e.value,e.name)||(n[e.name]=e.value)})),n})(e,t);((e,t)=>{const n=C(e.dom.attributes,(e=>e.name));xt(t)!==n.length&&((e,t,n)=>{L(t,(t=>{Nn(e,t)})),ht(n,((t,n)=>{Tn(e,n,t)}))})(e,n,t)})(e,n)},so=(e,t)=>{ro(Ce.fromDom(e),t)},ao=(e,t,n)=>{e(n,((e,r)=>A(t,(t=>((e,t,n,r)=>{const o=r.name,s=void 0!==r.condition?r.condition:S,a=void 0!==r.value?r.value:Jr.all();return Jr.matches(o,n)&&Jr.matches(a,t)&&s(e)})(n,e,r,t)))))},io="startElement",lo="endElement",co="text",mo="comment",uo=(e,t,n)=>{let r,o,s;const a=Ce.fromDom(e);switch(e.nodeType){case 1:t?r=lo:(r=io,Un(a,n||{}));const i=e;o="HTML"!==i.scopeName&&i.scopeName&&i.tagName&&i.tagName.indexOf(":")<=0?(i.scopeName+":"+i.tagName).toLowerCase():i.tagName.toLowerCase();break;case 3:r=co,s=e.nodeValue;break;case 8:r=mo,s=e.nodeValue;break;default:console.log("WARNING: Unsupported node type encountered: "+e.nodeType)}return{getNode:v(e),tag:()=>o,type:()=>r,text:()=>s}},po=(e,t,n,r)=>{const o=r.createElement(e);return ht(t,((e,t)=>{o.setAttribute(t,e+"")})),uo(o,!1,n)},go=(e,t)=>uo(t.createElement(e),!0),fo=go("html",window.document),ho=e=>{const t=e.createDocumentFragment();let n=t;const r=e=>{n.appendChild(e)};return{dom:t,receive:o=>{switch(o.type()){case io:s=o.getNode().cloneNode(!1),r(s),n=s;break;case co:(t=>{const n=e.createTextNode(t.text());r(n)})(o);break;case lo:(()=>{const e=n.parentNode;n=null===e?t:e})();break;case mo:break;default:throw new Error("Unsupported token type: "+o.type())}var s},label:"SERIALISER"}},vo=e=>t=>{((e,t)=>{const n=qr({styles:[],attributes:[],classes:[],tags:[]},t),r=Kt(e,"*");L(r,(e=>{ao(ro,n.styles,e),ao(oo,n.attributes,e),L(n.classes,(t=>{const n=En(e,"class")?(e=>Dn(e)?(e=>{const t=e.dom.classList,n=new Array(t.length);for(let e=0;e<t.length;e++){const r=t.item(e);null!==r&&(n[e]=r)}return n})(e):An(e))(e):[];L(n,(n=>{Jr.matches(t.name,n)&&Ln(e,n)}))}))}));const o=Kt(e,"*");L(o,(e=>{A(n.tags,x(Qr,e))&&hn(e)}))})(t,e)},yo=e=>t=>{((e,t)=>{const n=qr({tags:[]},t),r=Kt(e,"*");L(r,(e=>{A(n.tags,x(Qr,e))&&vn(e)}))})(t,e)},bo=e=>t=>{((e,t)=>{const n=qr({tags:[]},t),r=Kt(e,"*");L(r,(e=>{M(n.tags,x(Qr,e)).each((t=>{t.mutate(e)}))}))})(t,e)},xo=e=>t=>{const n=Kn(t),r=((e,t,n)=>{const r=ho(e),o=((e,t=window.document)=>{const n=t.createElement("div");t.body.appendChild(n),n.style.position="absolute",n.style.left="-10000px",n.innerHTML=e;let r=n.firstChild||fo;const o=[];let s=!1;return{hasNext:()=>void 0!==r,next:()=>{const e=r,a=r,i=s;return!s&&e.firstChild?(o.push(e),r=e.firstChild):s||1!==e.nodeType?e.nextSibling?(r=e.nextSibling,s=!1):(r=o.pop(),s=!0):s=!0,a===fo||r||(t.body.removeChild(n),r=fo),(l=a)===fo?l:l?uo(l,i):void 0;var l}}})(t,e),s=((e,t,n)=>{let r=n;for(let n=t.length-1;n>=0;n--)r=t[n](r,{},e);return r})(e,n,r);for(;o.hasNext();){const e=o.next();s.receive(e)}return r.dom})(Rt(t).dom,n,e);fn(t),t.dom.appendChild(r)},wo=(e,t,n)=>{const r=Ce.fromTag("div",e.dom);Un(r,{position:"fixed",left:"-100000px",top:"0px"}),dn((e=>{const t=e.dom.body;if(null==t)throw new Error("Body is not available yet");return Ce.fromDom(t)})(e),r),r.dom.innerHTML=t,L(n,(e=>{e(r)}));const o=Kn(r);return hn(r),o},To=(e,t)=>n=>{const r=e=>{n.receive(e)},o=(e,t,n)=>(n=void 0!==n?n:e.type()===lo,uo(t,n,{})),s={emit:r,emitTokens:e=>{L(e,r)},receive:t=>{e(s,t,o)},document:window.document};return t(s),s},Io=(e,t)=>{if(void 0===e||void 0===t)throw console.trace(),new Error("brick");e.nextFilter.set(t)},So=(e,t,n=!1)=>e===t||u(e)&&u(t)&&e.tag===t.tag&&e.type===t.type&&(n||e.variant===t.variant),Oo=(e,t)=>En(Ce.fromDom(t.getNode()),"data-list-level"),Eo=(e,t,n,r)=>{const o=n.getCurrentListType(),s=n.getCurrentLevel()==r.level()?o:null;return(a=r.emblems(),i=s,M(a,(e=>"ul"===e.tag||u(i)&&So(e,i,!0))).orThunk((()=>B(a)))).filter((e=>!("ol"===e.tag&&(e=>{if(D(["p"],e.tag())){const t=((e,t)=>{const n=Ce.fromDom(e.getNode());return Sn(n,"class")})(e);return u(t)&&/^MsoHeading/.test(t)}return!0})(t))));var a,i},No=e=>(t,n,r)=>{const o=r,s=(e=>{const t=parseInt(Sn(e,"data-list-level"),10),n=Sn(e,"data-list-emblems"),r=u(n)?JSON.parse(n):[];return Nn(e,"data-list-level"),Nn(e,"data-list-emblems"),{level:v(t),emblems:v(r)}})(Ce.fromDom(o.getNode()));n.originalToken.set(o);const a=((e,t,n)=>(Eo(n.listType.get(),e,n.emitter,t).each(n.listType.set),((e,t,n)=>({level:v(e),token:v(t),type:v(n)}))(t.level(),n.originalToken.get(),n.listType.get())))(o,s,n);n.emitter.openItem(a.level(),a.token(),a.type()),Io(n,e.inside())},ko=(e,t,n)=>({pred:e,action:t,label:v(n)});var Do=(e,t,n)=>{const r=(e,r,o)=>{M(t,(e=>e.pred(r,o))).fold(v(n),(e=>e.action))(e,r,o)};return r.toString=()=>"Handlers for "+e,r};const Ao=(e,t)=>({state:v(e),result:v(t)}),Co=(e,t)=>({state:v(e),value:v(t)}),Lo=(e,t,n,r)=>({level:v(e),type:v(t),types:v(n),items:v(r)}),_o=e=>{const t=e.items().slice(0);if(t.length>0&&"p"!==t[t.length-1]){const n=t[t.length-1];t[t.length-1]="p";const r=Lo(e.level(),e.type(),e.types(),t);return Co(r,O.some(n))}return Co(e,O.none())},Ro=(e,t,n)=>{let r=[],o=e;for(;t(o);){const e=n(o);o=e.state(),r=r.concat(e.result())}return Ao(o,r)},Po=(e,t,n)=>{const r=t.start&&t.start>1?{start:t.start}:{},o=e.level()+1,s=t,a=e.types().concat([t]),i=[x(po,t.tag,r,n)],l=Lo(o,s,a,e.items());return Ao(l,i)},Mo=e=>{const t=e.types().slice(0),n=[x(go,t.pop().tag)],r=e.level()-1,o=t[t.length-1],s=Lo(r,o,t,e.items());return Ao(s,n)},Fo=(e,t,n)=>{const r=(l=t)?(e=>{const t=((e,t)=>{const n=Ce.fromDom(e.getNode());return zn(n,"margin-left")})(e);return u(t)&&"0px"!==t?{"margin-left":t}:{}})(l):{"list-style-type":"none"},o=e.type()&&!So(e.type(),n)?((e,t)=>{const n=Mo(e),r=Po(n.state(),t,t.type?{"list-style-type":t.type}:{});return Ao(r.state(),n.result().concat(r.result()))})(e,n):Ao(e,[]),s=[x(po,"li",{},r)],a=((e,t)=>{const n=e.items().slice(0),r=void 0!==t&&"p"!==t?O.some(t):O.none();r.fold((()=>{n.push("p")}),(e=>{n.push(e)}));const o=Lo(e.level(),e.type(),e.types(),n);return Co(o,r)})(o.state(),t&&t.tag()),i=a.value().map((e=>{const n=t;return so(n.getNode(),S),[v(n)]})).getOr([]);var l;return Ao(a.state(),o.result().concat(s).concat(i))},jo=e=>{const t=x(go,"li"),n=_o(e),r=n.value().fold((()=>[t]),(e=>[x(go,e),t]));return Ao(n.state(),r)},Ho=e=>{if(0===e.length)throw new Error("Compose must have at least one element in the list");const t=e[e.length-1],n=H(e,(e=>e.result()));return Ao(t.state(),n)},Uo=e=>{const t=jo(e),n=Mo(t.state());return Ho([t,n])},zo=(e,t)=>((e,t,n)=>Ro(e,(e=>e.level()>t),n))(e,t,Uo),Bo=(e,t,n,r)=>{const o=e.level()>t?zo(e,t):Ao(e,[]),s=o.state().level()===t?((e,t,n)=>{const r=e.level()>0?jo(e):Ao(e,[]),o=Fo(r.state(),n,t);return Ho([r,o])})(o.state(),r,n):((e,t,n,r)=>{const o=n>1?_o(e):Co(e,O.none()),s=o.value().map((e=>[x(go,e)])).getOr([]),a=((e,t,n,r)=>((e,t,n)=>Ro(e,(e=>e.level()<t),n))(e,n,(e=>((e,t,n,r)=>{const o=e.level()===n-1&&t.type?{"list-style-type":t.type}:{},s=Po(e,t,o),a=Fo(s.state(),s.state().level()==n?r:void 0,t);return Ho([s,a])})(e,t,n,r))))(o.state(),t,n,r);return Ao(a.state(),s.concat(a.result()))})(o.state(),r,t,n);return Ho([o,s])},Wo=zo,$o=["disc","circle","square"],Go={getCurrentListType:()=>Vo().getCurrentListType(),getCurrentLevel:()=>Vo().getCurrentLevel(),closeAllLists:()=>Vo().closeAllLists(),openItem:(e,t,n)=>Vo().openItem(e,t,n)};let Vo=()=>({getCurrentListType:v({}),getCurrentLevel:v(1),closeAllLists:f,openItem:y});const qo={inside:()=>Xo,outside:()=>Yo},Ko=(()=>{let e=!1;return{check:t=>!(!e||t.type()!==co)||(t.type()===io&&"style"===t.tag()?(e=!0,!0):t.type()===lo&&"style"===t.tag()&&(e=!1,!0))}})(),Xo=(e=>Do("Inside.List.Item",[ko(((e,t)=>{const n=e.originalToken.get();return t.type()===lo&&null!==n&&t.tag()===n.tag()}),((t,n)=>{Io(n,e.outside())}),"Closing open tag")],((e,t,n)=>{e.emit(n)})))(qo),Yo=(e=>Do("Outside.List.Item",[ko(Oo,No(e),"Data List ****"),ko(((e,t)=>t.type()===co&&(e=>e.type()===co&&/^[\s\u00A0]*$/.test(e.text()))(t)),((e,t,n)=>{e.emit(n)}),"Whitespace")],((t,n,r)=>{n.emitter.closeAllLists(),t.emit(r),Io(n,e.outside())})))(qo),Zo=(e=>{const t=ae(e),n=ae(null),r=ae(null);return{reset:o=>{t.set(e),n.set(null),r.set(null),Vo=v(((e,t)=>{let n=Lo(0,void 0,[],[]);const r=n=>{L(n.result(),(n=>{const r=n(t);e.emit(r)}))};return{closeAllLists:()=>{const e=Wo(n,0);n=e.state(),r(e)},openItem:(e,t,o)=>{if(!o)return;const s=((e,t)=>"ul"===e.tag&&$o[t-1]===e.type?{tag:"ul"}:e)(o,e),a=Bo(n,e,t,s);n=a.state(),r(a)},getCurrentListType:()=>n.type(),getCurrentLevel:()=>n.level()}})(o,o.document))},nextFilter:t,originalToken:n,listType:r,emitter:Go}})(Yo);var Jo=To(((e,t,n)=>{Ko.check(t)||((e,t,n)=>{t.nextFilter.get()(e,t,n)})(e,Zo,t)}),Zo.reset);const Qo=e=>e.dom.textContent,es=[{regex:/^\(?[dc][\.\)]$/,type:{tag:"ol",type:"lower-alpha"}},{regex:/^\(?[DC][\.\)]$/,type:{tag:"ol",type:"upper-alpha"}},{regex:/^\(?M*(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})[\.\)]$/,type:{tag:"ol",type:"upper-roman"}},{regex:/^\(?m*(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})[\.\)]$/,type:{tag:"ol",type:"lower-roman"}},{regex:/^\(?[0-9]+[\.\)]$/,type:{tag:"ol"}},{regex:/^([0-9]+\.)*[0-9]+\.?$/,type:{tag:"ol",variant:"outline"}},{regex:/^\(?[a-z]+[\.\)]$/,type:{tag:"ol",type:"lower-alpha"}},{regex:/^\(?[A-Z]+[\.\)]$/,type:{tag:"ol",type:"upper-alpha"}}],ts={"\u2022":{tag:"ul",type:"disc"},"\xb7":{tag:"ul",type:"disc"},"\xa7":{tag:"ul",type:"square"}},ns={o:{tag:"ul",type:"circle"},"-":{tag:"ul",type:"disc"},"\u25cf":{tag:"ul",type:"disc"},"\ufffd":{tag:"ul",type:"circle"}},rs=(e,t)=>m(e.variant)?"("===t.charAt(0)?"()":")"===t.charAt(t.length-1)?")":".":e.variant,os=e=>{const t=e.split("."),n=(()=>{if(0===t.length)return e;const n=t[t.length-1];return 0===n.length&&t.length>1?t[t.length-2]:n})(),r=parseInt(n,10);return isNaN(r)?{}:{start:r}},ss=e=>{const t=(e=>eo(e,["mso-list"],I)["mso-list"])(e),n=u(t)&&/ level([0-9]+)/.exec(t);return n&&n[1]?O.some(parseInt(n[1],10)):O.none()},as=(e,t)=>{const n=((e,t)=>{const n=ns[e]?[ns[e]]:[],r=((e,t)=>t&&ts[e]?[ts[e]]:t?[{tag:"ul",variant:e}]:[])(e,t),o=H(es,(t=>t.regex.test(e)?[qr(t.type,os(e),{variant:rs(t.type,e)})]:[])),s=n.concat(r).concat(o);return C(s,(t=>void 0!==t.variant?t:qr(t,{variant:e})))})(Qo(e).trim(),t);return n.length>0?O.some(n):O.none()},is=e=>Yn(e,Te).bind(Ht).filter(Ne("span")),ls=e=>Zn(e,(e=>!!(Ie(e)?eo(e,["mso-list"],I):{})["mso-list"])),cs=e=>Ie(e)&&Wn(e,"font-family").exists((e=>D(["wingdings","symbol"],e.toLowerCase()))),ms=(e,t,n,r)=>{((e,t,n)=>{Tn(e,"data-list-level",t);const r=JSON.stringify(n);Tn(e,"data-list-emblems",r)})(e,t,n),(e=>{const t=((e,t)=>{const n=t.getOr(S);return(e=>{const t=[];for(;null!==e.nextNode();)t.push(Ce.fromDom(e.currentNode));return t})(document.createTreeWalker(e.dom,NodeFilter.SHOW_COMMENT,{acceptNode:e=>n(e.nodeValue)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}))})(e,O.none());L(t,hn)})(e),L(r,hn),Nn(e,"style"),Nn(e,"class")},ds=e=>(e=>ss(e).bind((t=>(e=>Yn(e,cs))(e).bind((n=>as(n,!0).map((r=>({mutate:()=>{ms(e,t,r,[n])}}))))))))(e).orThunk((()=>(e=>ss(e).bind((t=>is(e).bind((n=>as(n,cs(n)).map((r=>({mutate:()=>{ms(e,t,r,[n])}}))))))))(e))).orThunk((()=>(e=>ss(e).bind((t=>is(e).bind((n=>as(n,cs(n)).map((r=>({mutate:()=>{ms(e,t,r,[n])}}))))))))(e))).orThunk((()=>(e=>"p"!==be(e)?O.none():ss(e).bind((t=>ls(e).bind((n=>as(n,!1).map((r=>({mutate:()=>{ms(e,t,r,[Ft(n).getOr(n)])}}))))))))(e))).orThunk((()=>(e=>"p"!==be(e)?O.none():ls(e).bind((t=>{const n=Ft(t).getOr(t),r=cs(n);return as(t,r).bind((t=>(e=>Wn(e,"margin-left").bind((e=>{const t=parseInt(e,10);return isNaN(t)?O.none():O.some(Math.max(1,Math.ceil(t/18)))})))(e).map((r=>({mutate:()=>{ms(e,r,t,[n])}})))))})))(e))),us=bo({tags:[{name:Jr.pattern(/^(p|h\d+)$/,Jr.caseInsensitive),mutate:e=>{ds(e).each((e=>{e.mutate()}))}}]}),ps=Jo,gs=e=>{return(o=e,Te(o)?(t=o,n="v:shape",O.from((r=t,r.dom.nodeValue)).bind((e=>{const t=e.indexOf("]>"),r=(e=>{try{return(new DOMParser).parseFromString(e,"text/html").body}catch(t){const n=document.implementation.createHTMLDocument("").body;return n.innerHTML=e,n}})(`<div>${e.slice(t+"]>".length,e.lastIndexOf("<!["))}</div>`);return Zn(Ce.fromDom(r),(e=>be(e)===n))}))):O.none()).map((e=>{const t=Sn(e,"o:spid"),n=void 0===t?On(e,"id").getOr(""):t,r=Ce.fromTag("img");return Cn(r,"rtf-data-image"),Tn(r,"data-image-id",n.substr("_x0000_".length)),Tn(r,"data-image-type","code"),((e,t)=>{const n=e.dom;ht(t,((e,t)=>{e.fold((()=>{jn(n,t)}),(e=>{Fn(n,t,e)}))}))})(r,{width:Wn(e,"width"),height:Wn(e,"height")}),r}));var t,n,r,o},fs=e=>{if(Ne("img")(e)){const t=Sn(e,"src");if(null!=t&&de(t,"file://")){const n=(e=>((e,t)=>Ce.fromDom(e.dom.cloneNode(!1)))(e))(e),r=t.split(/[\/\\]/),o=r[r.length-1];return Tn(n,"data-image-id",o),Nn(n,"src"),Tn(n,"data-image-type","local"),Cn(n,"rtf-data-image"),O.some(n)}return O.none()}return O.none()};var hs;!function(e){e[e.Word=0]="Word",e[e.GoogleDocs=1]="GoogleDocs",e[e.Html=2]="Html"}(hs||(hs={}));const vs=e=>t=>{On(t,e.attrName).each((n=>{const r=u(e.styleName)?e.styleName:e.attrName;if(Wn(t,r).isNone()){const o=e.mapValue(n);Hn(t,r,o)}Nn(t,e.attrName)}))},ys=e=>{const t=be(e);return"td"===t||"tr"===t||"col"===t||"th"===t},bs=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,xs=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,ws=e=>ce(e,"#").toUpperCase(),Ts=e=>{const t=e.toString(16);return(1===t.length?"0"+t:t).toUpperCase()},Is=e=>(e=>({value:e}))(Ts(e.red)+Ts(e.green)+Ts(e.blue)),Ss=/^\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i,Os=/^\s*rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?(?:\.\d+)?)\s*\)\s*$/i,Es=(e,t,n,r)=>({red:e,green:t,blue:n,alpha:r}),Ns=(e,t,n,r)=>{const o=parseInt(e,10),s=parseInt(t,10),a=parseInt(n,10),i=parseFloat(r);return Es(o,s,a,i)},ks=e=>{return"currentcolor"===e||"transparent"===e?e:"#"+(t=ce(e,"#").toUpperCase(),(e=>bs.test(e)||xs.test(e))(t)?O.some({value:ws(t)}):O.none()).orThunk((()=>(e=>{if("transparent"===e)return O.some(Es(0,0,0,0));const t=Ss.exec(e);if(null!==t)return O.some(Ns(t[1],t[2],t[3],"1"));const n=Os.exec(e);return null!==n?O.some(Ns(n[1],n[2],n[3],n[4])):O.none()})(e).map(Is))).getOrThunk((()=>{const t=document.createElement("canvas");t.height=1,t.width=1;const n=t.getContext("2d");n.clearRect(0,0,t.width,t.height),n.fillStyle="#FFFFFF",n.fillStyle=e,n.fillRect(0,0,1,1);const r=n.getImageData(0,0,1,1).data,o=r[0],s=r[1],a=r[2],i=r[3];return Is(Es(o,s,a,i))})).value;var t},Ds=(e,t)=>{switch(t){case"color":return ks(e);case"font-family":return e.replace(/['"]/g,"");case"font-weight":return(e=>{switch(e){case"bold":return"700";case"normal":return"400";default:return e}})(e);default:return ue(t,"-color")?ks(e):(e=>e.replace(/^0(pt|px|pc|in|cm|mm|Q|cap|ch|ic|em|ex|lh|rlh|rem|vw|vh|vb|vi|vmax|vmin|%)$/,"0"))(e)}},As=bo({tags:[{name:Jr.pattern(/^(p|div)$/,Jr.caseInsensitive),mutate:e=>{const t="ltr"===Vn(e),n=t?"margin-left":"margin-right",r=t?"padding-left":"padding-right";Wn(e,n).each((()=>{const t=zn(e,n);Hn(e,r,t),Gn(e,n)}))}}]}),Cs=yo({tags:[{name:Jr.exact("b",Jr.caseInsensitive),condition:e=>On(e,"id").exists((e=>de(e,"docs-internal-guid")))}]}),Ls=vo({attributes:[{name:Jr.exact("id",Jr.caseInsensitive),value:Jr.starts("docs-internal-guid",Jr.caseInsensitive)}]}),_s=[bo({tags:[{name:Jr.exact("col",Jr.caseInsensitive),mutate:vs({attrName:"width",mapValue:e=>e.replace(/^(\d+)$/,"$1px")})}]})],Rs=e=>bo({tags:[{name:Jr.exact(e.matchTag,Jr.caseInsensitive),mutate:t=>{var n,r;(n=$n(t),r=e.key,wt(n,r)?O.from(n[r]):O.none()).exists((t=>D(e.values,t)))&&(un(t,Ce.fromTag(e.newTag)),Gn(t,e.key),l(e.removeExtra)&&L(e.removeExtra,(e=>Gn(t,e))))}}]}),Ps=[Rs({matchTag:"span",key:"font-weight",values:["700","bold"],newTag:"strong"}),Rs({matchTag:"span",key:"font-style",values:["italic"],newTag:"em"}),Rs({matchTag:"span",key:"vertical-align",values:["sub"],newTag:"sub",removeExtra:["font-size"]}),Rs({matchTag:"span",key:"vertical-align",values:["super"],newTag:"sup",removeExtra:["font-size"]})],Ms=e=>t=>{const n=[],r={border:e.browser.isFirefox()?"medium none":"none","text-decoration":"none"},o=(e,t)=>{if(!m(t)){const r=Ce.fromTag(be(e));dn(t,r),n.push({me:e,fake:r})}const r=R(zt(e),Ie);L(r,(t=>o(t,e)))};o(t);const s=C(n,(e=>{const{fake:t,me:n}=e,o=$n(n),s=bt(o,((e,n)=>{const r=zn(t,n);return Ds(e,n)===Ds(r,n)})),a=bt(r,((e,t)=>Rn(Wn(n,t),e)));return{fake:t,me:n,toRemove:s,toPreserve:a}}));L(s,(e=>{const{me:t,toRemove:n,toPreserve:r,fake:o}=e;ht(n,((e,n)=>{Gn(t,n)})),ht(r,((e,n)=>{Hn(t,n,e)})),hn(o)}))},Fs=["p","div","article","aside","details","dt","figcaption","footer","form","fieldset","header","hgroup","html","main","nav","section","summary","body","dl","multicol","dd","figure","address","center","blockquote","h1","h2","h3","h4","h5","h6","listing","xmp","pre","plaintext","menu","dir","ul","ol","li","hr","table","tbody","thead","tfoot","th","tr","td","caption"],js=vo({styles:[{name:Jr.exact("background-color",Jr.caseInsensitive),value:Jr.exact("transparent",Jr.caseInsensitive)},{name:Jr.exact("white-space",Jr.caseInsensitive),value:Jr.starts("pre",Jr.caseInsensitive)},{name:Jr.pattern(/^overflow(-[xy])?$/,Jr.caseInsensitive),condition:e=>ys(e)&&Rn(Wn(e,"overflow"),"hidden")},{name:Jr.exact("overflow-wrap",Jr.caseInsensitive),condition:ys},{name:Jr.exact("table-layout",Jr.caseInsensitive),value:Jr.exact("fixed",Jr.caseInsensitive),condition:Ne("table")},{name:Jr.exact("line-height",Jr.caseInsensitive),value:Jr.exact("1.38",Jr.caseInsensitive)},{name:Jr.exact("vertical-align",Jr.caseInsensitive),value:Jr.exact("baseline",Jr.caseInsensitive)},{name:Jr.exact("font-style",Jr.caseInsensitive),value:Jr.exact("normal",Jr.caseInsensitive)},{name:Jr.exact("font-variant",Jr.caseInsensitive),value:Jr.exact("normal",Jr.caseInsensitive)},{name:Jr.exact("background-color",Jr.caseInsensitive),value:Jr.exact("transparent",Jr.caseInsensitive)},{name:Jr.starts("padding",Jr.caseInsensitive),condition:ys},{name:Jr.pattern(/^text-decoration(-(line|thickness|style|color))?$/,Jr.caseInsensitive),condition:e=>!Ne("a")(e)&&Rn(Wn(e,"text-decoration"),"none")}],attributes:[{name:Jr.exact("aria-level",Jr.caseInsensitive),condition:Ne("li")},{name:Jr.exact("dir",Jr.caseInsensitive),value:Jr.exact("ltr",Jr.caseInsensitive),condition:e=>D(Fs,be(e))},{name:Jr.exact("role",Jr.caseInsensitive),value:Jr.exact("presentation",Jr.caseInsensitive),condition:e=>Ne("p")(e)&&Ft(e).exists(Ne("li"))}]}),Hs=vo({styles:[{name:Jr.exact("text-align",Jr.caseInsensitive),value:Jr.exact("right",Jr.caseInsensitive),condition:e=>"rtl"===Vn(e)}]}),Us=bo({tags:[{name:Jr.exact("p",Jr.caseInsensitive),condition:e=>{const t=t=>Wn(e,t).map((e=>parseInt(e,10))).filter((e=>!isNaN(e))).getOr(0),n=Vn(e);return t("text-indent")+t("rtl"===n?"padding-right":"padding-left")===0},mutate:e=>{const t=Vn(e);Gn(e,"text-indent"),Gn(e,"rtl"===t?"padding-right":"padding-left")}}]}),zs=e=>t=>_n(t,e),Bs=fe(Se,"text"),Ws=e=>Bs.get(e),$s=e=>{const t=e.dom.attributes;return null==t||0===t.length||1===t.length&&"style"===t[0].name},Gs=(e,t)=>{const n=Ce.fromTag(e);ln(t,n);const r=t.dom.attributes;L(r,(e=>{n.dom.setAttribute(e.name,e.value)}));const o=zt(t);return gn(n,o),hn(t),n},Vs=Ne("li"),qs=e=>jt(e).bind((e=>Se(e)&&0===Ws(e).trim().length?qs(e):Vs(e)?O.some(e):O.none())),Ks=e=>{const t=Gs("span",e),n={"font-size":{1:"8pt",2:"10pt",3:"12pt",4:"14pt",5:"18pt",6:"24pt",7:"36pt"}};ht({face:"font-family",size:"font-size",color:"color"},((e,r)=>{On(t,r).each((o=>{const s=n[e],a=void 0!==s&&void 0!==s[o]?s[o]:o;Hn(t,e,a),Nn(t,r)}))}))},Xs=vo({tags:[{name:Jr.exact("script",Jr.caseInsensitive)},{name:Jr.exact("link",Jr.caseInsensitive)},{name:Jr.exact("style",Jr.caseInsensitive),condition:e=>0===Kn(e).length}],attributes:[{name:Jr.starts("on",Jr.caseInsensitive)},{name:Jr.exact('"',Jr.caseInsensitive)},{name:Jr.exact("lang",Jr.caseInsensitive)},{name:Jr.exact("language",Jr.caseInsensitive)}],styles:[{name:Jr.all(),value:Jr.pattern(/OLE_LINK/i,Jr.caseInsensitive)}]}),Ys=vo({tags:[{name:Jr.exact("meta",Jr.caseInsensitive)}]}),Zs=vo({tags:[{name:Jr.exact("style",Jr.caseInsensitive)}]}),Js=vo({styles:[{name:Jr.not(Jr.pattern(/^(width|height|list-style-type)$/,Jr.caseInsensitive)),condition:e=>!_n(e,"ephox-limbo-transform")},{name:Jr.pattern(/^(width|height)$/,Jr.caseInsensitive),condition:e=>{return(e=>"img"!==be(e))(e)&&!("table"===be(t=e)||ys(t));var t}}]}),Qs=(e=[])=>{const t=C(e,(e=>({name:Jr.exact(e,Jr.caseInsensitive)})));return yo({tags:t})},ea=vo({classes:[{name:Jr.not(Jr.exact("rtf-data-image",Jr.caseInsensitive))}]}),ta=vo({styles:[{name:Jr.pattern(/^(mso-.*|tab-stops|tab-interval|language|text-underline|text-effect|text-line-through|font-color|horiz-align|list-image-[0-9]+|separator-image|table-border-color-(dark|light)|vert-align|vnd\..*)$/,Jr.caseInsensitive)}]}),na=vo({classes:[{name:Jr.pattern(/mso/i,Jr.caseInsensitive)}]}),ra=yo({tags:[{name:Jr.exact("img",Jr.caseInsensitive),condition:e=>{const t=Sn(e,"src");return a(t)&&/^file:/.test(t)}}]}),oa=yo({tags:[{name:Jr.exact("a",Jr.caseInsensitive),condition:$s}]}),sa=vo({attributes:[{name:Jr.exact("style",Jr.caseInsensitive),value:Jr.exact("",Jr.caseInsensitive)}]}),aa=vo({attributes:[{name:Jr.exact("class",Jr.caseInsensitive),value:Jr.exact("",Jr.caseInsensitive)}]}),ia=yo({tags:[{name:Jr.pattern(/^(font|em|strong|samp|acronym|cite|code|dfn|kbd|tt|b|i|u|s|sub|sup|ins|del|var|span)$/,Jr.caseInsensitive),condition:(la=e=>!$s(e)||(e=>{const t=e.dom.attributes,n=null!=t&&t.length>0;return"span"!==be(e)||n})(e)&&Zn(e,(e=>{const t=!$s(e),n=!D(["font","em","strong","samp","acronym","cite","code","dfn","kbd","tt","b","i","u","s","sub","sup","ins","del","var","span"],be(e));return Se(e)||t||n})).isSome(),e=>!la(e))}]});var la;const ca=bo({tags:[{name:Jr.exact("p",Jr.caseInsensitive),mutate:e=>{0===Kn(e).length&&dn(e,Ce.fromTag("br"))}}]}),ma=e=>{const t=Gs("span",e);Cn(t,"ephox-limbo-transform"),Hn(t,"text-decoration","underline")},da=bo({tags:[{name:Jr.pattern(/ol|ul/,Jr.caseInsensitive),mutate:e=>{Ft(e).each((t=>{const n=be(t);D(["ol","ul"],n)&&qs(e).fold((()=>{const t=Ce.fromTag("li");Hn(t,"list-style-type","none"),un(e,t)}),(t=>{dn(t,e)}))}))}}]}),ua=e=>{const t=[{name:"b",transform:{mutate:x(Gs,"strong")}},{name:"i",transform:{mutate:x(Gs,"em")}},{name:"u",transform:{mutate:ma}},{name:"s",transform:{mutate:x(Gs,"strike")}},{name:"font",transform:{mutate:Ks,debug:!0}}],n=R(t,(t=>!D(e,t.name))).map((e=>({name:Jr.exact(e.name,Jr.caseInsensitive),...e.transform})));return bo({tags:n})},pa=vo({classes:[{name:Jr.exact("ephox-limbo-transform",Jr.caseInsensitive)}]}),ga=vo({tags:[{name:Jr.exact("br",Jr.caseInsensitive),condition:zs("Apple-interchange-newline")}]}),fa=vo({styles:[{name:Jr.pattern(/^-/,Jr.caseInsensitive)},{name:Jr.all(),value:Jr.exact("initial",Jr.caseInsensitive)},{name:Jr.exact("background-color",Jr.caseInsensitive),value:Jr.exact("transparent",Jr.caseInsensitive)},{name:Jr.exact("font-style",Jr.caseInsensitive),value:Jr.exact("normal",Jr.caseInsensitive)},{name:Jr.pattern(/font-variant.*/,Jr.caseInsensitive)},{name:Jr.exact("letter-spacing",Jr.caseInsensitive)},{name:Jr.exact("font-weight",Jr.caseInsensitive),value:Jr.pattern(/400|normal/,Jr.caseInsensitive)},{name:Jr.exact("orphans",Jr.caseInsensitive)},{name:Jr.exact("text-decoration",Jr.caseInsensitive),value:Jr.exact("none",Jr.caseInsensitive)},{name:Jr.exact("text-size-adjust",Jr.caseInsensitive)},{name:Jr.exact("text-indent",Jr.caseInsensitive),value:Jr.exact("0px",Jr.caseInsensitive)},{name:Jr.exact("text-transform",Jr.caseInsensitive),value:Jr.exact("none",Jr.caseInsensitive)},{name:Jr.exact("white-space",Jr.caseInsensitive),value:Jr.exact("normal",Jr.caseInsensitive)},{name:Jr.exact("widows",Jr.caseInsensitive)},{name:Jr.exact("word-spacing",Jr.caseInsensitive),value:Jr.exact("0px",Jr.caseInsensitive)},{name:Jr.exact("text-align",Jr.caseInsensitive),value:Jr.pattern(/start|end/,Jr.caseInsensitive)},{name:Jr.exact("font-weight",Jr.caseInsensitive),value:Jr.pattern(/700|bold/,Jr.caseInsensitive),condition:e=>/^h\d$/.test(be(e))}]}),ha=(()=>{const e=(e,t)=>n=>e(n).filter((e=>Se(n)&&t(Qo(e)||""," "))).isSome(),t=e(jt,ue),n=e(Ht,de);return bo({tags:[{name:Jr.exact("span",Jr.caseInsensitive),condition:zs("Apple-converted-space"),mutate:e=>{"\xa0"===Qo(e)&&(t(e)||n(e)?vn(e):(ln(e,Ce.fromText(" ")),hn(e)))}}]})})(),va=(()=>{const e=/^file:\/\/\/[^#]+(#[^#]+)$/;return bo({tags:[{name:Jr.exact("a",Jr.caseInsensitive),condition:t=>{const n=Sn(t,"href");return!!n&&e.test(n)},mutate:t=>{On(t,"href").each((n=>{Tn(t,"href",n.replace(e,"$1"))}))}}]})})(),ya=vo({attributes:[{name:Jr.exact("href",Jr.caseInsensitive),value:Jr.starts("file:///",Jr.caseInsensitive)}]}),ba=(()=>{const e=(e,t,n)=>({name:Jr.exact(e,Jr.caseInsensitive),condition:e=>En(e,t),mutate:e=>{On(e,t).each((r=>{Tn(e,n,r),Nn(e,t)}))}});return bo({tags:[e("a","data-ephox-href","href"),e("img","data-ephox-src","src")]})})(),xa=e=>{const t=["table","thead","tbody","tfoot","th","tr","td","ul","ol","li"],n=qt(e,Te),r=M(n,(e=>me(De(e),"StartFragment"))),o=M(n,(e=>me(De(e),"EndFragment")));r.each((n=>{o.each((r=>{let o=n;const s=[];let a=((e,t,n,r)=>{const o=en(e,0,n,0);return Ce.fromDom(o.commonAncestorContainer)})(n,0,r);for(;void 0!==a&&!Et(a,e);)D(t,be(a))?o=a:s.push(a),a=Ft(a).getOrUndefined();L(s,vn),L(Ut(o),hn)})),hn(n)})),o.each(hn)},wa=bo({tags:[{name:Jr.pattern(/^(img|table)$/,Jr.caseInsensitive),mutate:e=>{Wn(e,"margin-left").exists((e=>de(e,"-")))&&Gn(e,"margin-left"),de(zn(e,"margin-left"),"-")&&(Hn(e,"margin-top",zn(e,"margin-top")),Hn(e,"margin-bottom",zn(e,"margin-bottom")),Hn(e,"margin-right",zn(e,"margin-right")),Gn(e,"margin"))}}]}),Ta=bo({tags:[{name:Jr.exact("p",Jr.caseInsensitive),mutate:vs({attrName:"align",styleName:"text-align",mapValue:y})}]}),Ia=(e,t)=>{return(n=e,Bs.getOption(n)).exists((e=>0===t(e).length));var n},Sa=vo({tags:[{name:Jr.exact("font",Jr.caseInsensitive),condition:e=>{const t=zt(e),n=e=>e.replace(/[ \r\n\uFEFF]+/g,"");return 0===t.length||U(t,(e=>Ia(e,n)))}}]}),Oa=e=>L(zt(e),(e=>{Ia(e,pe)&&hn(e)})),Ea=bo({tags:[{name:Jr.exact("ol",Jr.caseInsensitive),mutate:Oa},{name:Jr.exact("ul",Jr.caseInsensitive),mutate:Oa}]}),Na=yo({tags:[{name:Jr.pattern(/^([OVWXP]|U[0-9]+|ST[0-9]+):/i,Jr.caseInsensitive)}]}),ka=[xo([ps])],Da=vo({attributes:[{name:Jr.exact("height",Jr.caseInsensitive),condition:Ne("table")}]}),Aa=vo({attributes:[{name:Jr.pattern(/^(width|height)$/,Jr.caseInsensitive),condition:ys}]}),Ca=bo({tags:[{name:Jr.exact("table",Jr.caseInsensitive),mutate:vs({attrName:"width",mapValue:e=>e.replace(/^(\d+)$/,"$1px")})}]}),La=vo({styles:[{name:Jr.exact("height",Jr.caseInsensitive),condition:Ne("td")},{name:Jr.exact("width",Jr.caseInsensitive),condition:Ne("tr")},{name:Jr.exact("height",Jr.caseInsensitive),condition:Ne("col")}]}),_a=vo({attributes:[{name:Jr.pattern(/^v:/,Jr.caseInsensitive)},{name:Jr.exact("href",Jr.caseInsensitive),value:Jr.contains("#_toc",Jr.caseInsensitive)},{name:Jr.exact("href",Jr.caseInsensitive),value:Jr.contains("#_mso",Jr.caseInsensitive)},{name:Jr.pattern(/^xmlns(:|$)/,Jr.caseInsensitive)},{name:Jr.exact("type",Jr.caseInsensitive),condition:e=>"ol"===be(e)||"ul"===be(e)}]});yo({tags:[{name:Jr.exact("p",Jr.caseInsensitive),condition:("li",e=>Ft(e).exists((e=>"li"===be(e)&&1===zt(e).length)))}]}),bo({tags:[{name:Jr.pattern(/^(img|table)$/,Jr.caseInsensitive),mutate:e=>{Wn(e,"margin-left").exists((e=>de(e,"-")))&&Gn(e,"margin-left"),de(zn(e,"margin-left"),"-")&&(Hn(e,"margin-top",zn(e,"margin-top")),Hn(e,"margin-bottom",zn(e,"margin-bottom")),Hn(e,"margin-right",zn(e,"margin-right")),Gn(e,"margin"))}}]});const Ra=e=>{const t=[Ta,ta,na],n=[Ta,Js,Qs(e.cleanFilteredInlineElements),ea];return e.merge?t:n},Pa=e=>e.type===hs.Word?[us]:[],Ma=e=>e.type===hs.Word?[Na,...ka,_a]:[],Fa=e=>e.type===hs.GoogleDocs?[Cs]:[],ja=e=>e.type!==hs.GoogleDocs||e.indentUseMargin?[]:[As],Ha=(e,t)=>e.type===hs.GoogleDocs?[js,...Ps,..._s,Ms(t),Hs,Us,...ja(e)]:[],Ua=e=>e.type===hs.Html&&e.merge?[fa]:[],za=e=>e.type===hs.Word?[La,Ca,Aa,Da]:[];At([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);const Ba=(e,t)=>Ga(document.createElement("canvas"),e,t),Wa=e=>{const t=Ba(e.width,e.height);return $a(t).drawImage(e,0,0),t},$a=e=>e.getContext("2d"),Ga=(e,t,n)=>(e.width=t,e.height=n,e),Va=e=>e.naturalWidth||e.width,qa=e=>e.naturalHeight||e.height,Ka=e=>new Promise(((t,n)=>{const r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="blob",r.onload=function(){200===this.status&&t(this.response)},r.onerror=function(){n(0===this.status?(()=>{const e=new Error("No access to download image");return e.code=18,e.name="SecurityError",e})():(()=>new Error("Error "+this.status+" downloading image"))())},r.send()})),Xa=e=>{const t=e.split(","),n=/data:([^;]+)/.exec(t[0]);if(!n)return O.none();const r=n[1],o=t[1],s=1024,a=atob(o),i=a.length,l=Math.ceil(i/s),c=new Array(l);for(let e=0;e<l;++e){const t=e*s,n=Math.min(t+s,i),r=new Array(n-t);for(let e=t,o=0;e<n;++o,++e)r[o]=a[e].charCodeAt(0);c[e]=new Uint8Array(r)}return O.some(new Blob(c,{type:r}))},Ya=e=>new Promise(((t,n)=>{Xa(e).fold((()=>{n("uri is not base64: "+e)}),t)})),Za=(e,t,n)=>(t=t||"image/png",p(HTMLCanvasElement.prototype.toBlob)?new Promise(((r,o)=>{e.toBlob((e=>{e?r(e):o()}),t,n)})):Ya(e.toDataURL(t,n))),Ja=e=>(e=>{const t=URL.createObjectURL(e),n=new Image;return n.src=t,(e=>new Promise(((t,n)=>{const r=()=>{s(),t(e)},o=[Er(e,"load",r),Er(e,"error",(()=>{s(),n("Unable to load data from image: "+e.dom.src)}))],s=()=>L(o,(e=>e.unbind()));e.dom.complete&&r()})))(Ce.fromDom(n)).then((e=>e.dom))})(e).then((e=>{ei(e);const t=Ba(Va(e),qa(e));return $a(t).drawImage(e,0,0),t})),Qa=e=>new Promise((t=>{const n=new FileReader;n.onloadend=()=>{t(n.result)},n.readAsDataURL(e)})),ei=e=>{URL.revokeObjectURL(e.src)},ti=(e,t,n)=>{const r=t.type,o=v(r),s=v(n),a=(t,n)=>e.then((e=>((e,t,n)=>(t=t||"image/png",e.toDataURL(t,n)))(e,t,n)));return{getType:o,toBlob:()=>Promise.resolve(t),toDataURL:s,toBase64:()=>n.split(",")[1],toAdjustedBlob:(t,n)=>e.then((e=>Za(e,t,n))),toAdjustedDataURL:a,toAdjustedBase64:(e,t)=>a(e,t).then((e=>e.split(",")[1])),toCanvas:()=>e.then(Wa)}},ni=(e,t)=>Za(e,t).then((t=>ti(Promise.resolve(e),t,e.toDataURL()))),ri=(e,t,n)=>{const r=Va(e),o=qa(e);let s=t/r,a=n/o,i=!1;(s<.5||s>2)&&(s=s<.5?.5:2,i=!0),(a<.5||a>2)&&(a=a<.5?.5:2,i=!0);const l=oi(e,s,a);return i?l.then((e=>ri(e,t,n))):l},oi=(e,t,n)=>new Promise((r=>{const o=Va(e),s=qa(e),a=Math.floor(o*t),i=Math.floor(s*n),l=Ba(a,i);$a(l).drawImage(e,0,0,o,s,0,0,a,i),r(l)})),si=(e,t=2)=>{const n=Math.pow(10,t),r=Math.round(e*n);return Math.ceil(r/n)},ai=(e,t,n,r,o)=>((e,t,n,r,o)=>e.toCanvas().then((s=>((e,t,n,r,o,s)=>{const a=Ba(o,s);return $a(a).drawImage(e,-n,-r),ni(a,t)})(s,e.getType(),t,n,r,o))))(e,t,n,r,o),ii=(e,t)=>((e,t)=>e.toCanvas().then((n=>((e,t,n)=>{const r=(n<0?360+n:n)*Math.PI/180,o=e.width,s=e.height,a=Math.sin(r),i=Math.cos(r),l=si(Math.abs(o*i)+Math.abs(s*a)),c=si(Math.abs(o*a)+Math.abs(s*i)),m=Ba(l,c),d=$a(m);return d.translate(l/2,c/2),d.rotate(r),d.drawImage(e,-o/2,-s/2),ni(m,t)})(n,e.getType(),t))))(e,t),li=(e,t)=>((e,t)=>ti(Ja(e),e,t))(e,t),ci=e=>(e=>(e=>{const t=e.src;return 0===t.indexOf("data:")?Ya(t):Ka(t)})(e).then((e=>(e=>Qa(e).then((t=>ti(Ja(e),e,t))))(e))))(e),mi=e=>e.toBlob(),di=e=>e.toDataURL(),ui=e=>parseInt(e,10),pi=e=>e.isPx&&(e.cropWidth!==e.width||e.cropHeight!==e.height),gi=/rotate\((\d\.\d+)rad\)/,fi=(e,t,n)=>ci(e.dom).then((e=>t=>((e,t,n)=>((e,t,n)=>e.toCanvas().then((r=>ri(r,t,n).then((t=>ni(t,e.getType()))))))(e,t,n))(t,e.width,e.height))(t)).then(((e,t)=>n=>{if(pi(t)){const r=-1*ui(zn(e,"margin-top")),o=-1*ui(zn(e,"margin-left"));return ai(n,o,r,t.cropWidth,t.cropHeight).then((n=>(In(e,{width:t.cropWidth,height:t.cropHeight}),n)))}return Promise.resolve(n)})(e,t)).then(((e,t)=>n=>(e=>{const t=zn(e,"transform");return O.from(gi.exec(t)).map((e=>Math.round(parseFloat(e[1])*(180/Math.PI))))})(t).fold((()=>Promise.resolve(n)),(r=>ii(n,r).then((n=>(Gn(t,"transform"),Nn(e,"width"),Nn(e,"height"),n))))))(e,n)).then((t=>{const n=di(t);return Tn(e,"src",n),Promise.resolve()})),hi=e=>Ft(e).filter(Ne("span")).map((t=>{const n=()=>((e,t)=>{var n,r,o;Gn(e,"margin-top"),Gn(e,"margin-left"),Gn(t,"width"),Gn(t,"height"),Gn(t,"overflow"),Gn(t,"display"),r=e,o=["transform"],Ie(n=t)&&Ie(r)&&L(o,(e=>{((e,t,n)=>{Wn(e,n).each((e=>{Wn(t,n).isNone()&&Hn(t,n,e)}))})(n,r,e)})),Gn(t,"transform")})(e,t),r=((e,t)=>{const n=(e,t)=>On(e,t).map(ui).filter((e=>!isNaN(e))).getOr(0),r=zn(t,"width"),o=zn(t,"height"),s=n(e,"width"),a=n(e,"height"),i=/^\d+px$/;return{isPx:i.test(r)&&i.test(o),cropWidth:ui(r),cropHeight:ui(o),width:s,height:a}})(e,t);return(pi(r)||gi.test(zn(t,"transform"))?fi(e,r,t):Promise.resolve()).then(n,n)})).getOrThunk((()=>Promise.resolve()));var vi=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","li","table","thead","tbody","tfoot","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"];const yi=(e,t)=>F(e,(e=>e.start===t)),bi=(e,t,n=0)=>P(e,((e,n)=>t(n,e.len).fold(v(e),(t=>({len:t.finish,list:e.list.concat([t])})))),{len:n,list:[]}).list,xi=(e,t,n)=>0===t.length?e:H(e,(e=>{const r=H(t,(t=>((e,t)=>t>=e.start&&t<=e.finish)(e,t)?[t-e.start]:[]));return r.length>0?((e,t,n)=>((e,t)=>C(e,(e=>({...e,start:e.start+t,finish:e.finish+t}))))(n(e,t),e.start))(e,r,n):[e]})),wi=(e,t,n)=>({element:e,start:t,finish:n}),Ti=At([{include:["item"]},{excludeWith:["item"]},{excludeWithout:["item"]}]),Ii={include:Ti.include,excludeWith:Ti.excludeWith,excludeWithout:Ti.excludeWithout,cata:(e,t,n,r)=>e.fold(t,n,r)},Si=At([{boundary:["item","universe"]},{empty:["item","universe"]},{text:["item","universe"]},{nonEditable:["item","universe"]}]),Oi=I,Ei=S,Ni=v(0),ki=v(1),Di=e=>({...e,isBoundary:()=>e.fold(Ei,Oi,Oi,Oi),toText:()=>e.fold(O.none,O.none,(e=>O.some(e)),O.none),is:t=>e.fold(Oi,Oi,((e,n)=>n.eq(e,t)),Oi),len:()=>e.fold(Ni,ki,((e,t)=>t.property().getText(e).length),ki)}),Ai={text:h(Di,Si.text),boundary:h(Di,Si.boundary),empty:h(Di,Si.empty),nonEditable:h(Di,Si.empty),cata:(e,t,n,r,o)=>e.fold(t,n,r,o)},Ci=v([]),Li=(e,t,n)=>{if(e.property().isText(t))return[Ai.text(t,e)];if(e.property().isEmptyTag(t))return[Ai.empty(t,e)];if(e.property().isNonEditable(t))return[];if(e.property().isElement(t)){const r=e.property().children(t),o=e.property().isBoundary(t)?[Ai.boundary(t,e)]:[],s=void 0!==n&&n(t)?[]:H(r,(t=>Li(e,t,n)));return o.concat(s).concat(o)}return[]},_i=Li,Ri=(e,t,n)=>{const r=((e,t)=>{const n=[];let r=[];return L(e,(e=>{const o=t(e);Ii.cata(o,(()=>{r.push(e)}),(()=>{r.length>0&&n.push(r),n.push([e]),r=[]}),(()=>{r.length>0&&n.push(r),r=[]}))})),r.length>0&&n.push(r),n})(H(t,(t=>_i(e,t,n))),(e=>e.match({boundary:()=>Ii.excludeWithout(e),empty:()=>Ii.excludeWith(e),text:()=>Ii.include(e),nonEditable:()=>Ii.excludeWithout(e)})));return R(r,(e=>e.length>0))},Pi=(e,t,n)=>{const r=H(n,(e=>[e.start,e.finish])),o=xi(t,r,((t,n)=>((e,t,n)=>{const r=e.property().getText(t),o=R(((e,t)=>{if(0===t.length)return[e];const n=P(t,((t,n)=>{if(0===n)return t;const r=e.substring(t.prev,n);return{prev:n,values:t.values.concat([r])}}),{prev:0,values:[]}),r=t[t.length-1];return r<e.length?n.values.concat(e.substring(r)):n.values})(r,n),(e=>e.length>0));if(o.length<=1)return[wi(t,0,r.length)];e.property().setText(t,o[0]);const s=bi(o.slice(1),((t,n)=>{const r=e.create().text(t),o=wi(r,n,n+t.length);return O.some(o)}),o[0].length),a=C(s,(e=>e.element));return e.insert().afterAll(t,a),[wi(t,0,o[0].length)].concat(s)})(e,t.element,n)));return C(n,(t=>{const n=((e,t,n)=>{const r=yi(e,t),o=yi(e,n);return r.bind((t=>{const r=o.getOr(((e,t)=>e[e.length-1]&&e[e.length-1].finish===t?e.length+1:-1)(e,n));return r>-1?O.some(e.slice(t,r)):O.none()})).getOr([])})(o,t.start,t.finish),r=C(n,(e=>e.element)),s=C(r,e.property().getText).join("");return{elements:r,word:t.word,exact:s}}))},Mi=(e,t,n,r)=>{const o=Ri(e,t,r),s=H(o,(t=>{const r=H(t,(e=>e.fold(Ci,Ci,(e=>[e]),Ci))),o=((e,t)=>{const n=H(t,(t=>{const n=((e,t)=>{const n=t.term(),r=[];let o=n.exec(e);for(;o;){const s=o.index+t.prefix(o),a=o[0].length-t.prefix(o)-t.suffix(o);r.push({start:s,finish:s+a}),n.lastIndex=s+a,o=n.exec(e)}return r})(e,t.pattern);return C(n,(e=>({...t,...e})))}));return(e=>{const t=Array.prototype.slice.call(e,0);return t.sort(((e,t)=>e.start<t.start?-1:t.start<e.start?1:0)),t})(n)})(C(r,e.property().getText).join(""),n),s=((e,t)=>bi(t,((t,n)=>{const r=n+e.property().getText(t).length;return O.from(wi(t,n,r))})))(e,r);return Pi(e,s,o)}));return s},Fi={up:v({selector:Jn,closest:Qn,predicate:Xn,all:(e,t)=>{const n=p(t)?t:I;let r=e.dom;const o=[];for(;null!==r.parentNode&&void 0!==r.parentNode;){const e=r.parentNode,t=Ce.fromDom(e);if(o.push(t),!0===n(t))break;r=e}return o}}),down:v({selector:Kt,predicate:qt}),styles:v({get:zn,getRaw:Wn,set:Hn,remove:Gn}),attrs:v({get:Sn,set:Tn,remove:Nn,copyTo:(e,t)=>{const n=P(e.dom.attributes,((e,t)=>(e[t.name]=t.value,e)),{});In(t,n)}}),insert:v({before:ln,after:cn,afterAll:pn,append:dn,appendAll:gn,prepend:mn,wrap:un}),remove:v({unwrap:vn,remove:hn}),create:v({nu:Ce.fromTag,clone:e=>Ce.fromDom(e.dom.cloneNode(!1)),text:Ce.fromText}),query:v({comparePosition:(e,t)=>e.dom.compareDocumentPosition(t.dom),prevSibling:jt,nextSibling:Ht}),property:v({children:zt,name:be,parent:Ft,document:e=>Pt(e).dom,isText:Se,isComment:Te,isElement:Ie,isSpecial:e=>{const t=be(e);return D(["script","noscript","iframe","noframes","noembed","title","style","textarea","xmp"],t)},getLanguage:e=>Ie(e)?On(e,"lang"):O.none(),getText:Ws,setText:(e,t)=>Bs.set(e,t),isBoundary:e=>!!Ie(e)&&("body"===be(e)||D(vi,be(e))),isEmptyTag:e=>!!Ie(e)&&D(["br","img","hr","input"],be(e)),isNonEditable:e=>Ie(e)&&"false"===Sn(e,"contenteditable")}),eq:Et,is:Nt},ji=/(?:[A-Za-z][A-Za-z\d.+-]{0,14}:\/\/(?:[-.~*+=!&;:'%@?^${}(),\w]+@)?|www\.|[-;:&=+$,.\w]+@)[A-Za-z\d-]+(?:\.[A-Za-z\d-]+)*(?::\d+)?(?:\/(?:[-+~=.,%()\/\w]*[-+~=%()\/\w])?)?(?:\?(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?(?:#(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?/g.source,Hi=e=>!Qn(e,"a",undefined).isSome(),Ui=e=>{const t=(e=>{return((e,t,n)=>Mi(Fi,e,t,void 0))(e,[{word:"__INTERNAL__",pattern:(t=ji,((e,t,n,r)=>({term:()=>new RegExp(e,r.getOr("g")),prefix:t,suffix:n}))(t,v(0),v(0),O.none()))}]);var t})(e);L(t,(e=>{const t=e.exact;(t.indexOf("@")<0||zi(t))&&(e=>{O.from(e[0]).filter(Hi).map((t=>{const n=Ce.fromTag("a");return ln(t,n),gn(n,e),Tn(n,"href",Qo(n)),n}))})(e.elements)}))},zi=e=>{const t=e.indexOf("://");return t>=3&&t<=9},Bi=e=>{L(e,(e=>{Ie(e)&&Wn(e,"position").isSome()&&Gn(e,"position")}))},Wi=e=>{const t=R(e,Ne("li"));if(t.length>0){const n=Ut(t[0]),r=Ce.fromTag("ul");if(ln(e[0],r),n.length>0){const e=Ce.fromTag("li");dn(r,e),gn(e,n)}gn(r,t)}},$i=e=>{const t=zt(e);L([Ui,Bi,Wi],(e=>{e(t)}))},Gi={disabled:()=>({discriminator:"disabled",data:{}}),fromClipboard:e=>({discriminator:"fromClipboard",data:{rtf:e}})},Vi=gt(Gi),qi=Gi.disabled,Ki=Gi.fromClipboard,Xi=e=>void 0!==e&&void 0!==e.types&&null!==e.types,Yi=(e,t)=>{const n=new RegExp(t,"i");return W(e,(e=>Pn(null!==n.exec(e),{type:e,flavor:t})))};var Zi=Object.hasOwnProperty,Ji=Object.setPrototypeOf,Qi=Object.isFrozen,el=Object.getPrototypeOf,tl=Object.getOwnPropertyDescriptor,nl=Object.freeze,rl=Object.seal,ol=Object.create,sl="undefined"!=typeof Reflect&&Reflect,al=sl.apply,il=sl.construct;al||(al=function(e,t,n){return e.apply(t,n)}),nl||(nl=function(e){return e}),rl||(rl=function(e){return e}),il||(il=function(e,t){return new(Function.prototype.bind.apply(e,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t))))});var ll,cl=bl(Array.prototype.forEach),ml=bl(Array.prototype.pop),dl=bl(Array.prototype.push),ul=bl(String.prototype.toLowerCase),pl=bl(String.prototype.match),gl=bl(String.prototype.replace),fl=bl(String.prototype.indexOf),hl=bl(String.prototype.trim),vl=bl(RegExp.prototype.test),yl=(ll=TypeError,function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return il(ll,t)});function bl(e){return function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return al(e,t,r)}}function xl(e,t){Ji&&Ji(e,null);for(var n=t.length;n--;){var r=t[n];if("string"==typeof r){var o=ul(r);o!==r&&(Qi(t)||(t[n]=o),r=o)}e[r]=!0}return e}function wl(e){var t=ol(null),n=void 0;for(n in e)al(Zi,e,[n])&&(t[n]=e[n]);return t}function Tl(e,t){for(;null!==e;){var n=tl(e,t);if(n){if(n.get)return bl(n.get);if("function"==typeof n.value)return bl(n.value)}e=el(e)}return function(e){return console.warn("fallback value for",e),null}}var Il=nl(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Sl=nl(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ol=nl(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),El=nl(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Nl=nl(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),kl=nl(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Dl=nl(["#text"]),Al=nl(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Cl=nl(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ll=nl(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),_l=nl(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Rl=rl(/\{\{[\s\S]*|[\s\S]*\}\}/gm),Pl=rl(/<%[\s\S]*|[\s\S]*%>/gm),Ml=rl(/^data-[\-\w.\u00B7-\uFFFF]/),Fl=rl(/^aria-[\-\w]+$/),jl=rl(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Hl=rl(/^(?:\w+script|data):/i),Ul=rl(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),zl=rl(/^html$/i),Bl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function Wl(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var $l=function(){return"undefined"==typeof window?null:window},Gl=function(e,t){if("object"!==(void 0===e?"undefined":Bl(e))||"function"!=typeof e.createPolicy)return null;var n=null,r="data-tt-policy-suffix";t.currentScript&&t.currentScript.hasAttribute(r)&&(n=t.currentScript.getAttribute(r));var o="dompurify"+(n?"#"+n:"");try{return e.createPolicy(o,{createHTML:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Vl=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$l(),n=function(t){return e(t)};if(n.version="2.3.6",n.removed=[],!t||!t.document||9!==t.document.nodeType)return n.isSupported=!1,n;var r=t.document,o=t.document,s=t.DocumentFragment,a=t.HTMLTemplateElement,i=t.Node,l=t.Element,c=t.NodeFilter,m=t.NamedNodeMap,d=void 0===m?t.NamedNodeMap||t.MozNamedAttrMap:m,u=t.HTMLFormElement,p=t.DOMParser,g=t.trustedTypes,f=l.prototype,h=Tl(f,"cloneNode"),v=Tl(f,"nextSibling"),y=Tl(f,"childNodes"),b=Tl(f,"parentNode");if("function"==typeof a){var x=o.createElement("template");x.content&&x.content.ownerDocument&&(o=x.content.ownerDocument)}var w=Gl(g,r),T=w?w.createHTML(""):"",I=o,S=I.implementation,O=I.createNodeIterator,E=I.createDocumentFragment,N=I.getElementsByTagName,k=r.importNode,D={};try{D=wl(o).documentMode?o.documentMode:{}}catch(e){}var A={};n.isSupported="function"==typeof b&&S&&void 0!==S.createHTMLDocument&&9!==D;var C=Rl,L=Pl,_=Ml,R=Fl,P=Hl,M=Ul,F=jl,j=null,H=xl({},[].concat(Wl(Il),Wl(Sl),Wl(Ol),Wl(Nl),Wl(Dl))),U=null,z=xl({},[].concat(Wl(Al),Wl(Cl),Wl(Ll),Wl(_l))),B=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),W=null,$=null,G=!0,V=!0,q=!1,K=!1,X=!1,Y=!1,Z=!1,J=!1,Q=!1,ee=!1,te=!0,ne=!0,re=!1,oe={},se=null,ae=xl({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),ie=null,le=xl({},["audio","video","img","source","image","track"]),ce=null,me=xl({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),de="http://www.w3.org/1998/Math/MathML",ue="http://www.w3.org/2000/svg",pe="http://www.w3.org/1999/xhtml",ge=pe,fe=!1,he=void 0,ve=["application/xhtml+xml","text/html"],ye="text/html",be=void 0,xe=null,we=o.createElement("form"),Te=function(e){return e instanceof RegExp||e instanceof Function},Ie=function(e){xe&&xe===e||(e&&"object"===(void 0===e?"undefined":Bl(e))||(e={}),e=wl(e),j="ALLOWED_TAGS"in e?xl({},e.ALLOWED_TAGS):H,U="ALLOWED_ATTR"in e?xl({},e.ALLOWED_ATTR):z,ce="ADD_URI_SAFE_ATTR"in e?xl(wl(me),e.ADD_URI_SAFE_ATTR):me,ie="ADD_DATA_URI_TAGS"in e?xl(wl(le),e.ADD_DATA_URI_TAGS):le,se="FORBID_CONTENTS"in e?xl({},e.FORBID_CONTENTS):ae,W="FORBID_TAGS"in e?xl({},e.FORBID_TAGS):{},$="FORBID_ATTR"in e?xl({},e.FORBID_ATTR):{},oe="USE_PROFILES"in e&&e.USE_PROFILES,G=!1!==e.ALLOW_ARIA_ATTR,V=!1!==e.ALLOW_DATA_ATTR,q=e.ALLOW_UNKNOWN_PROTOCOLS||!1,K=e.SAFE_FOR_TEMPLATES||!1,X=e.WHOLE_DOCUMENT||!1,J=e.RETURN_DOM||!1,Q=e.RETURN_DOM_FRAGMENT||!1,ee=e.RETURN_TRUSTED_TYPE||!1,Z=e.FORCE_BODY||!1,te=!1!==e.SANITIZE_DOM,ne=!1!==e.KEEP_CONTENT,re=e.IN_PLACE||!1,F=e.ALLOWED_URI_REGEXP||F,ge=e.NAMESPACE||pe,e.CUSTOM_ELEMENT_HANDLING&&Te(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(B.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&Te(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(B.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(B.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),he=he=-1===ve.indexOf(e.PARSER_MEDIA_TYPE)?ye:e.PARSER_MEDIA_TYPE,be="application/xhtml+xml"===he?function(e){return e}:ul,K&&(V=!1),Q&&(J=!0),oe&&(j=xl({},[].concat(Wl(Dl))),U=[],!0===oe.html&&(xl(j,Il),xl(U,Al)),!0===oe.svg&&(xl(j,Sl),xl(U,Cl),xl(U,_l)),!0===oe.svgFilters&&(xl(j,Ol),xl(U,Cl),xl(U,_l)),!0===oe.mathMl&&(xl(j,Nl),xl(U,Ll),xl(U,_l))),e.ADD_TAGS&&(j===H&&(j=wl(j)),xl(j,e.ADD_TAGS)),e.ADD_ATTR&&(U===z&&(U=wl(U)),xl(U,e.ADD_ATTR)),e.ADD_URI_SAFE_ATTR&&xl(ce,e.ADD_URI_SAFE_ATTR),e.FORBID_CONTENTS&&(se===ae&&(se=wl(se)),xl(se,e.FORBID_CONTENTS)),ne&&(j["#text"]=!0),X&&xl(j,["html","head","body"]),j.table&&(xl(j,["tbody"]),delete W.tbody),nl&&nl(e),xe=e)},Se=xl({},["mi","mo","mn","ms","mtext"]),Oe=xl({},["foreignobject","desc","title","annotation-xml"]),Ee=xl({},Sl);xl(Ee,Ol),xl(Ee,El);var Ne=xl({},Nl);xl(Ne,kl);var ke=function(e){var t=b(e);t&&t.tagName||(t={namespaceURI:pe,tagName:"template"});var n=ul(e.tagName),r=ul(t.tagName);if(e.namespaceURI===ue)return t.namespaceURI===pe?"svg"===n:t.namespaceURI===de?"svg"===n&&("annotation-xml"===r||Se[r]):Boolean(Ee[n]);if(e.namespaceURI===de)return t.namespaceURI===pe?"math"===n:t.namespaceURI===ue?"math"===n&&Oe[r]:Boolean(Ne[n]);if(e.namespaceURI===pe){if(t.namespaceURI===ue&&!Oe[r])return!1;if(t.namespaceURI===de&&!Se[r])return!1;var o=xl({},["title","style","font","a","script"]);return!Ne[n]&&(o[n]||!Ee[n])}return!1},De=function(e){dl(n.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){try{e.outerHTML=T}catch(t){e.remove()}}},Ae=function(e,t){try{dl(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){dl(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e&&!U[e])if(J||Q)try{De(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},Ce=function(e){var t=void 0,n=void 0;if(Z)e="<remove></remove>"+e;else{var r=pl(e,/^[\r\n\t ]+/);n=r&&r[0]}"application/xhtml+xml"===he&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");var s=w?w.createHTML(e):e;if(ge===pe)try{t=(new p).parseFromString(s,he)}catch(e){}if(!t||!t.documentElement){t=S.createDocument(ge,"template",null);try{t.documentElement.innerHTML=fe?"":s}catch(e){}}var a=t.body||t.documentElement;return e&&n&&a.insertBefore(o.createTextNode(n),a.childNodes[0]||null),ge===pe?N.call(t,X?"html":"body")[0]:X?t.documentElement:a},Le=function(e){return O.call(e.ownerDocument||e,e,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT,null,!1)},_e=function(e){return e instanceof u&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof d)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore)},Re=function(e){return"object"===(void 0===i?"undefined":Bl(i))?e instanceof i:e&&"object"===(void 0===e?"undefined":Bl(e))&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},Pe=function(e,t,r){A[e]&&cl(A[e],(function(e){e.call(n,t,r,xe)}))},Me=function(e){var t=void 0;if(Pe("beforeSanitizeElements",e,null),_e(e))return De(e),!0;if(pl(e.nodeName,/[\u0080-\uFFFF]/))return De(e),!0;var r=be(e.nodeName);if(Pe("uponSanitizeElement",e,{tagName:r,allowedTags:j}),!Re(e.firstElementChild)&&(!Re(e.content)||!Re(e.content.firstElementChild))&&vl(/<[/\w]/g,e.innerHTML)&&vl(/<[/\w]/g,e.textContent))return De(e),!0;if("select"===r&&vl(/<template/i,e.innerHTML))return De(e),!0;if(!j[r]||W[r]){if(!W[r]&&je(r)){if(B.tagNameCheck instanceof RegExp&&vl(B.tagNameCheck,r))return!1;if(B.tagNameCheck instanceof Function&&B.tagNameCheck(r))return!1}if(ne&&!se[r]){var o=b(e)||e.parentNode,s=y(e)||e.childNodes;if(s&&o)for(var a=s.length-1;a>=0;--a)o.insertBefore(h(s[a],!0),v(e))}return De(e),!0}return e instanceof l&&!ke(e)?(De(e),!0):"noscript"!==r&&"noembed"!==r||!vl(/<\/no(script|embed)/i,e.innerHTML)?(K&&3===e.nodeType&&(t=e.textContent,t=gl(t,C," "),t=gl(t,L," "),e.textContent!==t&&(dl(n.removed,{element:e.cloneNode()}),e.textContent=t)),Pe("afterSanitizeElements",e,null),!1):(De(e),!0)},Fe=function(e,t,n){if(te&&("id"===t||"name"===t)&&(n in o||n in we))return!1;if(V&&!$[t]&&vl(_,t));else if(G&&vl(R,t));else if(!U[t]||$[t]){if(!(je(e)&&(B.tagNameCheck instanceof RegExp&&vl(B.tagNameCheck,e)||B.tagNameCheck instanceof Function&&B.tagNameCheck(e))&&(B.attributeNameCheck instanceof RegExp&&vl(B.attributeNameCheck,t)||B.attributeNameCheck instanceof Function&&B.attributeNameCheck(t))||"is"===t&&B.allowCustomizedBuiltInElements&&(B.tagNameCheck instanceof RegExp&&vl(B.tagNameCheck,n)||B.tagNameCheck instanceof Function&&B.tagNameCheck(n))))return!1}else if(ce[t]);else if(vl(F,gl(n,M,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==fl(n,"data:")||!ie[e])if(q&&!vl(P,gl(n,M,"")));else if(n)return!1;return!0},je=function(e){return e.indexOf("-")>0},He=function(e){var t=void 0,r=void 0,o=void 0,s=void 0;Pe("beforeSanitizeAttributes",e,null);var a=e.attributes;if(a){var i={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:U};for(s=a.length;s--;){var l=t=a[s],c=l.name,m=l.namespaceURI;if(r=hl(t.value),o=be(c),i.attrName=o,i.attrValue=r,i.keepAttr=!0,i.forceKeepAttr=void 0,Pe("uponSanitizeAttribute",e,i),r=i.attrValue,!i.forceKeepAttr&&(Ae(c,e),i.keepAttr))if(vl(/\/>/i,r))Ae(c,e);else{K&&(r=gl(r,C," "),r=gl(r,L," "));var d=be(e.nodeName);if(Fe(d,o,r))try{m?e.setAttributeNS(m,c,r):e.setAttribute(c,r),ml(n.removed)}catch(e){}}}Pe("afterSanitizeAttributes",e,null)}},Ue=function e(t){var n=void 0,r=Le(t);for(Pe("beforeSanitizeShadowDOM",t,null);n=r.nextNode();)Pe("uponSanitizeShadowNode",n,null),Me(n)||(n.content instanceof s&&e(n.content),He(n));Pe("afterSanitizeShadowDOM",t,null)};return n.sanitize=function(e,o){var a=void 0,l=void 0,c=void 0,m=void 0,d=void 0;if((fe=!e)&&(e="\x3c!--\x3e"),"string"!=typeof e&&!Re(e)){if("function"!=typeof e.toString)throw yl("toString is not a function");if("string"!=typeof(e=e.toString()))throw yl("dirty is not a string, aborting")}if(!n.isSupported){if("object"===Bl(t.toStaticHTML)||"function"==typeof t.toStaticHTML){if("string"==typeof e)return t.toStaticHTML(e);if(Re(e))return t.toStaticHTML(e.outerHTML)}return e}if(Y||Ie(o),n.removed=[],"string"==typeof e&&(re=!1),re){if(e.nodeName){var u=be(e.nodeName);if(!j[u]||W[u])throw yl("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof i)1===(l=(a=Ce("\x3c!----\x3e")).ownerDocument.importNode(e,!0)).nodeType&&"BODY"===l.nodeName||"HTML"===l.nodeName?a=l:a.appendChild(l);else{if(!J&&!K&&!X&&-1===e.indexOf("<"))return w&&ee?w.createHTML(e):e;if(!(a=Ce(e)))return J?null:ee?T:""}a&&Z&&De(a.firstChild);for(var p=Le(re?e:a);c=p.nextNode();)3===c.nodeType&&c===m||Me(c)||(c.content instanceof s&&Ue(c.content),He(c),m=c);if(m=null,re)return e;if(J){if(Q)for(d=E.call(a.ownerDocument);a.firstChild;)d.appendChild(a.firstChild);else d=a;return U.shadowroot&&(d=k.call(r,d,!0)),d}var g=X?a.outerHTML:a.innerHTML;return X&&j["!doctype"]&&a.ownerDocument&&a.ownerDocument.doctype&&a.ownerDocument.doctype.name&&vl(zl,a.ownerDocument.doctype.name)&&(g="<!DOCTYPE "+a.ownerDocument.doctype.name+">\n"+g),K&&(g=gl(g,C," "),g=gl(g,L," ")),w&&ee?w.createHTML(g):g},n.setConfig=function(e){Ie(e),Y=!0},n.clearConfig=function(){xe=null,Y=!1},n.isValidAttribute=function(e,t,n){xe||Ie({});var r=be(e),o=be(t);return Fe(r,o,n)},n.addHook=function(e,t){"function"==typeof t&&(A[e]=A[e]||[],dl(A[e],t))},n.removeHook=function(e){A[e]&&ml(A[e])},n.removeHooks=function(e){A[e]&&(A[e]=[])},n.removeAllHooks=function(){A={}},n}();const ql=["script","svg"],Kl=e=>-1!==e.lastIndexOf("</html>"),Xl=e=>({sanitizeHtml:(t,n)=>e(t)?t:((e,t)=>{Vl.addHook("uponSanitizeElement",((e,t)=>{D(ql,t.tagName)||wt(t.allowedTags,t.tagName)||(t.allowedTags[t.tagName]=!0)})),Vl.addHook("uponSanitizeAttribute",((e,t)=>{0===t.attrName.indexOf("on")||wt(t.allowedAttributes,t.attrName)||(t.allowedAttributes[t.attrName]=!0),t.attrValue&&-1!==t.attrValue.indexOf("\n")&&(t.attrValue=t.attrValue.replace(/\r?\n/g,""))}));const n=(e=>de(pe(e),"<!"))(e),r=n?`<body>${e}</body>`:(e=>e.replace(/^[\S\s]*?(<!DOCTYPE|<html)/i,"$1"))(e),o=Vl.sanitize(r,{ALLOW_UNKNOWN_PROTOCOLS:!0,FORBID_TAGS:ql,WHOLE_DOCUMENT:Kl(e)});return Vl.removeHook("uponSanitizeElement"),Vl.removeHook("uponSanitizeAttribute"),n?(s=ce(o,"<body>"),ue(s,"</body>")?((e,t)=>e.substring(0,e.length-t))(s,"</body>".length):s):o;var s})(t),sanitizeText:y}),Yl={sanitizeHtml:y,sanitizeText:y},Zl=e=>t=>({discriminator:e,data:t}),Jl=e=>t=>t.discriminator===e?O.some(t.data):O.none(),Ql=Zl("event"),ec=Zl("html"),tc=Zl("images"),nc=Zl("word"),rc=Zl("text"),oc=Zl("void"),sc=Jl("html"),ac=Jl("images"),ic=Jl("word"),lc=Jl("text"),cc=["^image/","file"],mc=e=>(e=>me(e,"<html")&&(me(e,'xmlns:o="urn:schemas-microsoft-com:office:office"')||me(e,'xmlns:x="urn:schemas-microsoft-com:office:excel"')))(e)||(e=>me(e,'meta name="ProgId" content="Word.Document"'))(e),dc=e=>me(e,'id="docs-internal-guid-'),uc=e=>e.length>0,pc=(e,t)=>Yi(e.types,t).map((t=>e.getData(t.type))).filter(uc),gc=e=>pc(e,"html"),fc=e=>gc(e).filter(dc),hc=e=>O.from(e.clipboardData).filter(Xi),vc=e=>{const t=Ce.fromTag("div"),n=((e,t)=>wo(e,t,[xa]))(Rt(t),e);return((e,t)=>{const n=Rt(e).dom,r=Ce.fromDom(n.createDocumentFragment()),o=qn(t,n);gn(r,o),fn(e),dn(e,r)})(t,n),ec({container:t})},yc={native:"Outside of Textbox.io pasting HTML5 API (could be internal)",fallback:"Outside of Textbox.io pasting offscreen (could be internal)",msoffice:"Word Import pasting",googledocs:"Google Docs pasting",image:"Image pasting",plaintext:"Only plain text is available to paste",text:"Plain text pasting",none:"There is no valid way to paste",discard:"There is no valid way to paste, discarding content"},bc={getLabelForApi:e=>{const t=gt(yc);return M(t,(t=>yc[t]===e)).fold(v("unknown"),(e=>{switch(e){case"native":case"fallback":return"html";case"none":case"discard":return"invalid";default:return e}}))},...yc},xc=e=>C(e,(e=>e.asset)),wc=(e,t,n)=>{const r=Tt({cancel:pt([]),error:pt(["message"]),insert:pt(["elements","assets","correlated","isInternal","source","mode"]),block:pt(["state"])});let o=!1;r.registry.block.bind((e=>o=e.state));const s=(n,o)=>{r.trigger.block(!0);const s=((e,t,n)=>{const r=((e,t)=>W(e,(e=>e.getAvailable(t).map((t=>$r(e.steps,t,e.label,e.capture()))))))(e,n);return r.getOrThunk((()=>{const e=t.getAvailable(n);return $r(t.steps,e,t.label,t.capture())}))})(e,t,n);s.capture&&o();const a=((e,t)=>{const n={response:Rr([],[]),bundle:Hr({})},r=P(e,((e,n)=>Wr(e)?e.then((e=>Vr(e,t,n))):Vr(e,t,n)),n);return Wr(r)?r:Promise.resolve(r)})(s.steps,s.input),i=bc.getLabelForApi(s.label);a.then((e=>{const t=e.bundle.isInternal.getOr(!1),n=e.bundle.officeStyles.fold(v("auto"),(e=>e?"merge":"clean"));r.trigger.block(!1),Lr(e.response,(e=>{r.trigger.error(e)}),((e,o)=>{r.trigger.insert(e,xc(o),o,t,i,n)}),(()=>{r.trigger.cancel()}),((e,o,s)=>{r.trigger.insert(e,xc(o),o,t,i,n),r.trigger.error(s)}))}))};return{paste:e=>{const t=Mt(Ce.fromDom(e.target));an(t.dom).each((t=>{if(!_n(t.start,or())){const t=((e,t=Yl)=>{const n=e=>{return void 0===e.items?O.none():(t=cc,n=e.types,W(t,(e=>Yi(n,e)))).map((t=>{const n=[];for(let t=0;t<e.items.length;t++)n.push(e.items[t]);return tc({images:n})}));var t,n},r=e=>W(e.types,(n=>"text/plain"===n?O.some(e.getData(n)).map((e=>rc({text:t.sanitizeText(e)}))):O.none()));return{getWordData:()=>hc(e).bind((e=>(e=>gc(e).filter(mc))(e).map((t=>{const n=(e=>pc(e,"rtf"))(e);return nc({html:t,rtf:n.fold((()=>qi()),(e=>Ki(e)))})})))),getGoogleDocsData:()=>hc(e).bind(fc).map((e=>t.sanitizeHtml(e,"googledocs"))).map(vc),getImage:()=>hc(e).bind(n),getText:()=>hc(e).bind(r),getHtml:()=>hc(e).bind(gc).map(t.sanitizeHtml).map(vc),getOnlyText:()=>hc(e).bind((e=>{return 1===(t=e.types).length&&"text/plain"===t[0]?r(e):O.none();var t})),getNative:()=>Ql({nativeEvent:e}),getVoid:()=>oc({})}})(e,n);s(t,(()=>{e.preventDefault()}))}}))},pasteCustom:(e,t=f)=>{s(e,t)},isBlocked:()=>o,destroy:f,events:r.registry}},Tc=e=>Qa(e);var Ic={cata:(e,t,n)=>e.fold(t,n),...At([{blob:["id","imageresult","objurl"]},{url:["id","url","raw"]}])};const Sc=e=>{const t=URL.createObjectURL(e);return Oc(e,t)},Oc=(e,t)=>vr((n=>{Tc(e).then((r=>{const o=li(e,r),s=xn("image"),a=Ic.blob(s,o,t);n(a)}))})),Ec=e=>yr(C(e,Sc)),Nc=(e,t)=>({asset:e,image:t}),kc=(e,t)=>Ic.cata(e,((e,n,r)=>(Tn(t,"src",r),!0)),I),Dc=(e,t)=>{const n=[];return L(e,((e,r)=>{const o=t[r];kc(e,o)&&n.push(Nc(e,o))})),n},Ac=e=>Sc(e).toPromise(),Cc=(e,t)=>({asyncAsset:e.then(Tr.value,Tr.error),image:t}),Lc=e=>{const t=Ce.fromTag("div");return gn(t,e),Kt(t,"img[src]")},_c=e=>0===e.indexOf("data:")&&e.indexOf("base64")>-1,Rc=e=>0===e.indexOf("blob:"),Pc=e=>On(e,"src").exists((e=>_c(e)||Rc(e))),Mc=e=>H(Lc(e),(e=>{const t=On(e,"src").getOr("");return _c(t)?((e,t)=>{return(n=t,Xa(n)).map((t=>Cc(Ac(t),e)));var n})(e,t).toArray():Rc(t)?((e,t)=>{return(n=t,O.from(0===(r=n).indexOf("blob:")?Ka(r):0===r.indexOf("data:")?Ya(r):null)).map((t=>{const n=t.then(Ac);return Cc(n,e)}));var n,r})(e,t).toArray():[]})),Fc=e=>{const t=R(e,(e=>!Ne("img")(e)||!Pc(e)));return Mr(t,[],"errors.local.images.disallowed")};var jc=e=>(t,n)=>{const r=()=>Promise.resolve(n),o=(t,o)=>!1===e.allowLocalImages?(e=>{const t=R(Lc(e),Pc);return L(t,hn),Promise.resolve({response:t.length>0?Fc(e):n.response,bundle:n.bundle})})(t):0===o.length?(e=>{const t=Mc(e),r=Promise.all(C(t,(e=>e.asyncAsset))),o=C(t,(e=>e.image));return r.then((t=>{const r=(e=>{const t=[],n=[];return L(e,(e=>{e.fold((e=>{t.push(e)}),(e=>{n.push(e)}))})),{errors:t,values:n}})(t),s=Dc(r.values,o);return{response:r.errors.length>0?Mr(e,s,"errors.imageimport.failed"):Rr(e,s),bundle:n.bundle}}))})(t):r();return Lr(n.response,zr,o,r,o)};const Hc=(e,t,n=!1)=>new Promise((r=>{const o=new XMLHttpRequest;o.onreadystatechange=()=>{4===o.readyState&&r({status:o.status,blob:o.response})},o.open("GET",e,!0),o.withCredentials=n,ht(t,((e,t)=>{o.setRequestHeader(t,e)})),o.responseType="blob",o.send()})),Uc=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],zc=[{type:"not_found",message:"Failed to load image."},{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],Bc=e=>{const t=(e=>{const t=M(Uc,(t=>e===t.code)).fold(v("Unknown ImageProxy error"),(e=>e.message));return"ImageProxy HTTP error: "+t})(e);return Promise.reject(t)},Wc=e=>M(zc,(t=>t.type===e)).fold(v("Unknown service error"),(e=>e.message)),$c=e=>(e=>new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>{t(r.result)},r.onerror=e=>{n(e)},r.readAsText(e)})))(e).then((e=>{const t=(e=>{const t=(e=>{try{return O.some(JSON.parse(e))}catch(e){return O.none()}})(e),n=t.bind((e=>((e,t)=>{const n=P(["error","type"],((e,t)=>u(e)?e[t]:void 0),e);return O.from(n)})(e).map(Wc))).getOr("Invalid JSON in service error message");return"ImageProxy Service error: "+n})(e);return Promise.reject(t)})),Gc=e=>e<200||e>=300,Vc=(e,t,n=!1)=>t?((e,t)=>{const n={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":t};return Hc(((e,t)=>{const n=-1===e.indexOf("?")?"?":"&";return/[?&]apiKey=/.test(e)?e:e+n+"apiKey="+encodeURIComponent(t)})(e,t),n).then((e=>{return Gc(e.status)?((e,t)=>"application/json"===(null==t?void 0:t.type)&&(400===e||403===e||404===e||500===e))(t=e.status,n=e.blob)?$c(n):Bc(t):Promise.resolve(e.blob);var t,n}))})(e,t):((e,t)=>Hc(e,{},t).then((e=>Gc(e.status)?Bc(e.status):Promise.resolve(e.blob))))(e,n),qc=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,Kc=/^(?:(?![^:@\/]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Xc=/(?:^|&)([^&=]+)=?([^&]*)/g,Yc=e=>{const t={};for(;;){const n=Xc.exec(e);if(null===n)return t;t[n[1]]=n[2]}},Zc=(e,t)=>{const n=()=>Promise.resolve({response:t.response,bundle:t.bundle}),r=e=>Tc(e).then((t=>{const n=xn("image"),r=li(e,t),o=URL.createObjectURL(e);return Ic.blob(n,r,o)})),o=(e,t)=>Ic.url(xn("image"),t,e),s=(e,n)=>{let s=!1;const a=H(e,(e=>Kt(e,"img")));return Promise.all(C(a,(e=>{const t=e.dom.src;return(e=>{const t=((e,t={})=>{var n;return((e,t)=>{const n=(t?qc:Kc).exec(e),r=z(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],((e,t)=>{var r;return null!==(r=n[t])&&void 0!==r?r:""}));return{...r,queryKey:Yc(r.query)}})(e,null!==(n=t.strictMode)&&void 0!==n&&n)})(e);return me(t.host,"google")&&!de(t.path,"/drawings/")})(t)?Vc(e.dom.src).then(r,(()=>(s=!0,o(e,t)))):o(e,t)}))).then((r=>{const o=n.concat(Dc(r,a));return{response:s?Mr(e,o,"errors.imageimport.failed"):Rr(e,o),bundle:t.bundle}}),(()=>({response:_r("errors.imageimport.invalid"),bundle:t.bundle})))};return Lr(t.response,n,s,n,s)},Jc=e=>{const t=tm(e);return t&&Qc(e)||!t&&em(e)},Qc=e=>e.officeStyles.getOr(!0),em=e=>e.htmlStyles.getOr(!1),tm=e=>e.isWord.getOr(!1),nm=e=>e.isInternal.getOr(!1),rm=e=>tm(e)?hs.Word:(e=>e.isGoogleDocs.getOr(!1))(e)?hs.GoogleDocs:hs.Html,om=er("ephox-cement").resolve,sm=(e,t)=>{const n=((e,t)=>{const n=t.translations,r=e=>O.some(qr(t,{officeStyles:e,gdocsStyles:e,htmlStyles:e}));return{get:o=>{const s=(e=>{switch(e){case hs.Word:return"officeStyles";case hs.GoogleDocs:return"gdocsStyles";default:return"htmlStyles"}})(o),a=t[s];return p(a)?a().then((e=>r("merge"===e)),(e=>(console.error(e),r(!1)))):"clean"===a?Promise.resolve(r(!1)):"merge"===a?Promise.resolve(r(!0)):new Promise((t=>{const o=Ce.fromTag("div");Cn(o,om("styles-dialog-content"));const s=Ce.fromTag("p"),a=qn(n("cement.dialog.paste.instructions"));gn(s,a),dn(o,s);const i={text:n("cement.dialog.paste.clean"),tabindex:0,className:om("clean-styles"),click:()=>{c(),t(r(!1))}},l={text:n("cement.dialog.paste.merge"),tabindex:1,className:om("merge-styles"),click:()=>{c(),t(r(!0))}},c=()=>{m.destroy()},m=e();m.setTitle(n("cement.dialog.paste.title")),m.setContent(o),m.setButtons([i,l]),m.events.close.bind((()=>{c(),t(O.none())})),m.show()}))},destroy:f}})(e,t);return(e,t)=>{const r=t.bundle,o=t.response;return n.get(rm(r)).then((e=>e.fold((()=>({response:Pr(),bundle:t.bundle})),(e=>({response:o,bundle:Hr({officeStyles:e.officeStyles,gdocsStyles:e.gdocsStyles,htmlStyles:e.htmlStyles})})))))}},am=(e,t)=>(n,r)=>nm(r.bundle)?(e=>Promise.resolve({response:r.response,bundle:Hr({officeStyles:e,gdocsStyles:e,htmlStyles:e})}))(!0):sm(e,t)(n,r),im=(e,t)=>{if(!Vt(e))throw new Error("Internal error: attempted to write to an iframe that is not in the DOM");const n=(e=>(e=>{const t=e.dom;try{return((e,t)=>null!=e?O.some(t(e)):O.none())(t.contentWindow?t.contentWindow.document:t.contentDocument,Ce.fromDom)}catch(e){return console.log("Error reading iframe: ",t),console.log("Error was: "+e),O.none()}})(e).getOrThunk((()=>Rt(e))))(e),r=n.dom;r.open("text/html","replace"),r.writeln(t),r.close()};var lm=function(e){var t,n,r=e,o={a:0,b:0,c:0},s=[];return t=function(t,n){var a,i,l,c,m,d;if(t.test(r))for(i=0,l=(a=r.match(t)).length;i<l;i+=1)o[n]+=1,c=a[i],m=r.indexOf(c),d=c.length,s.push({selector:e.substr(m,d),type:n,index:m,length:d}),r=r.replace(c,Array(d+1).join(" "))},n=function(e){var t,n,o,s;if(e.test(r))for(n=0,o=(t=r.match(e)).length;n<o;n+=1)s=t[n],r=r.replace(s,Array(s.length+1).join("A"))},n(/\\[0-9A-Fa-f]{6}\s?/g),n(/\\[0-9A-Fa-f]{1,5}\s/g),n(/\\./g),function(){var e,t,n,o,s=/{[^]*/gm;if(s.test(r))for(t=0,n=(e=r.match(s)).length;t<n;t+=1)o=e[t],r=r.replace(o,Array(o.length+1).join(" "))}(),t(/(\[[^\]]+\])/g,"b"),t(/(#[^\#\s\+>~\.\[:\)]+)/g,"a"),t(/(\.[^\s\+>~\.\[:\)]+)/g,"b"),t(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,"c"),t(/(:(?!not|global|local)[\w-]+\([^\)]*\))/gi,"b"),t(/(:(?!not|global|local)[^\s\+>~\.\[:]+)/g,"b"),r=(r=(r=(r=(r=(r=r.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," ")).replace(/:not/g,"    ")).replace(/:local/g,"      ")).replace(/:global/g,"       ")).replace(/[\(\)]/g," "),t(/([^\s\+>~\.\[:]+)/g,"c"),s.sort((function(e,t){return e.index-t.index})),{selector:e,specificity:"0,"+o.a.toString()+","+o.b.toString()+","+o.c.toString(),specificityArray:[0,o.a,o.b,o.c],parts:s}},cm=e=>{const t=e.dom.styleSheets;return Array.prototype.slice.call(t)};const mm=e=>{const t=e.selectorText,n=e.style.cssText;if(void 0===n)throw new Error("WARNING: Browser does not support cssText property");return{selector:t,style:n,raw:e.style}},dm=e=>{const t=e.cssRules;return H(t,(e=>(e=>e.type===window.CSSRule.IMPORT_RULE)(e)?dm(e.styleSheet):(e=>e.type===window.CSSRule.STYLE_RULE)(e)?[mm(e)]:[]))},um=e=>H(e,dm),pm=(e,t,n)=>{const r=e=>-1!==e.selector.indexOf(","),o=H(R(e,r),(e=>{const t=e.selector.split(",");return C(t,(t=>({selector:t.trim(),raw:e.raw})))})),s=R(e,(e=>!r(e))).concat(o);s.sort(((e,t)=>function(e,t){var n,r,o;if("string"==typeof e){if(-1!==e.indexOf(","))throw"Invalid CSS selector";n=lm(e).specificityArray}else{if(!Array.isArray(e))throw"Invalid CSS selector or specificity array";if(4!==e.filter((function(e){return"number"==typeof e})).length)throw"Invalid specificity array";n=e}if("string"==typeof t){if(-1!==t.indexOf(","))throw"Invalid CSS selector";r=lm(t).specificityArray}else{if(!Array.isArray(t))throw"Invalid CSS selector or specificity array";if(4!==t.filter((function(e){return"number"==typeof e})).length)throw"Invalid specificity array";r=t}for(o=0;o<4;o+=1){if(n[o]<r[o])return-1;if(n[o]>r[o])return 1}return 0}(e.selector,t.selector))).reverse(),((e,t,n)=>{const r=H(t,(t=>{const n=Kt(e,t.selector);return L(n,(e=>{const n=((e,t)=>{const n={};return L(e,(r=>{if(void 0!==e[r]){const o=t.dom.style;D(o,r)||(n[r]=e[r])}})),n})(t.raw,e);Un(e,n)})),n}));n&&L(r,(e=>{Nn(e,"class")}))})(t,s,n)},gm=(e,t,n,r)=>{const o=cm(e),s=um(o).map((e=>{const t=e.selector;return{selector:n.hasOwnProperty(t)?n[t]:t,raw:e.raw}}));pm(s,t,r)},fm=(e,t,n,r)=>{const o=cm(e),s=um(o),a=R(s,(e=>de(e.selector,n)));pm(a,t,r)},hm=(e,t,n,r)=>{const o=cm(e),s=um(o),a=R(s,(e=>D(n,e.selector)));pm(a,t,r)};var vm={inlineStyles:(e,t,n)=>{gm(e,t,n,!0)},inlineStylesKeepClasses:(e,t,n)=>{gm(e,t,n,!1)},inlinePrefixedStyles:(e,t,n)=>{fm(e,t,n,!0)},inlinePrefixedStylesKeepClasses:(e,t,n)=>{fm(e,t,n,!1)},inlineSelectorsStyles:(e,t,n)=>{hm(e,t,n,!0)},inlineSelectorsStylesKeepClasses:(e,t,n)=>{hm(e,t,n,!1)}},ym={inlineStyles:vm.inlineStyles,inlineStylesKeepClasses:vm.inlineStylesKeepClasses,inlinePrefixedStyles:vm.inlinePrefixedStyles,inlinePrefixedStylesKeepClasses:vm.inlinePrefixedStylesKeepClasses,inlineSelectorsStyles:vm.inlineSelectorsStyles,inlineSelectorsStylesKeepClasses:vm.inlineSelectorsStylesKeepClasses};const bm={p:"p, li[data-converted-paragraph]"},xm=(e,t)=>{const n=Kt(e,"li[data-converted-paragraph]");if(L(n,(e=>{Nn(e,"data-converted-paragraph")})),t){const t=Kt(e,"li");L(t,(t=>{const n=(e=>{const t=(()=>{const t=Ce.fromTag("span");return mn(e,t),t})();return{convertToPx:e=>{return Hn(t,"margin-left",e),n=zn(t,"margin-left"),parseFloat(/-?\d+\.?\d*/.exec(n)[0]);var n},destroy:()=>hn(t)}})(e),r=((e,t)=>{const n=On(e,"data-tab-interval").getOr("36pt");return t.convertToPx(n)})(e,n),o=wm(t,r,n).getOr({});(e=>{Nn(e,"data-list-level"),Nn(e,"data-text-indent-alt"),Nn(e,"data-border-margin"),Gn(e,"margin-left"),Gn(e,"text-indent"),ht($n(e),((t,n)=>{!de(n,"border")||"border-image"!==n&&"none"!==t.trim()&&"initial"!==t.trim()||Gn(e,n)}))})(t),n.destroy(),Un(t,o)}));const n=Kt(e,"ol,ul");L(n,(e=>{const t=Kt(e,"li");Wn(e,"margin-top").isNone()&&O.from(t[0]).each((t=>{Hn(e,"margin-top",zn(t,"margin-top"))})),Wn(e,"margin-bottom").isNone()&&O.from(t[t.length-1]).each((t=>{Hn(e,"margin-bottom",zn(t,"margin-bottom"))}))}))}Nn(e,"data-tab-interval")},wm=(e,t,n)=>{const r=e=>On(e,"data-list-level").map((e=>parseInt(e,10))).getOr(1);return Wn(e,"text-indent").bind((o=>Wn(e,"margin-left").map((s=>{const a=Wn(e,"list-style").exists((e=>me(e,"none"))),i=On(e,"data-border-margin").getOr("0px"),l=a?r(e)+1:r(e),c=n.convertToPx(s)+n.convertToPx(i),m=t*l,d=On(e,"data-text-indent-alt").getOr(o),u=n.convertToPx(d),p={},g=t/2*-1-u;g>0&&(p["text-indent"]=g+"px");const f=c-m-g;return p["margin-left"]=f>0?f+"px":"0px",p}))))},Tm=e=>{const t=(n=Ce.fromDom(document.body),{play:(e,t,r)=>{const o=Ce.fromTag("div"),s=Ce.fromTag("iframe");Un(o,{display:"none"});const a=Er(s,"load",(()=>{var n;a.unbind(),im(s,e);const i=null===(n=s.dom.contentWindow)||void 0===n?void 0:n.document;if(void 0===i)throw new Error("sandbox iframe load event did not fire correctly");const l=Ce.fromDom(i),c=l.dom.body;if(void 0===c)throw new Error("sandbox iframe does not have a body");const m=Ce.fromDom(c),d=t(l,m);hn(o),setTimeout(x(r,d),0)}));dn(o,s),dn(n,o)}});var n;return n=>new Promise((r=>{t.play(n,((t,n)=>(((e,t,n)=>{const r=n.mergeInline();r&&(ym.inlineStyles(e,t,bm),(e=>{wa(e)})(t)),xm(t,r)})(t,n,{mergeInline:v(e)}),Kn(n))),r)}))},Im=(e,t,n,r)=>{const o=e.html;return n.cleanDocument(o,t,r).then((e=>{if(null==(n=e)||0===n.length)return{response:Rr([],[]),bundle:Hr({})};{const n=void 0===r.sanitizer?Xl(r.intraFlag.isMarked):r.sanitizer;return((e,t,n,r)=>{const o=e=>({response:e,bundle:Hr({})}),s=r.sanitizeHtml(t,"word");return Tm(e)(s).then((e=>{const t=qn(e),r=e=>o(Rr(t,e)),s=Ce.fromTag("div");gn(s,t);const a=R(Ot("img[src]",s),(e=>On(e,"src").exists((e=>de(e,"blob:")||de(e,"data:"))))),i=Ot("img[data-image-src]",s);if(0===a.length&&0===i.length)return r([]);if(n)return L(a,(e=>Nn(e,"id"))),(e=>Promise.all(C(e,(e=>{const t=e.dom;return ci(t).then((n=>n.toBlob().then((r=>((n,r)=>{const o=de(t.src,"blob:")?t.src:URL.createObjectURL(r),s=xn("image"),a=Ic.blob(s,n,o);return Nc(a,e)})(n,r)))))}))))(a).then(r);{L(a,hn),L(i,hn);const e=zt(s);return o(Mr(e,[],"errors.local.images.disallowed"))}}))})(t,e,r.allowLocalImages,n)}var n}),(e=>(console.error("PowerPaste error code: WIM01"),{response:_r("errors.paste.process.failure"),bundle:Hr({})})))},Sm=lt(),Om=e=>{try{const t=e(),n=null!=t&&t.length>0?qn(t):[];return Tr.value(n)}catch(e){return console.error("PowerPaste error code: PT01. Message: ",e),Tr.error("errors.paste.process.failure")}},Em=e=>e.fold(Ur,(e=>({response:Rr(e,[]),bundle:Hr({})}))),Nm=(e,t,n,r,o)=>Om((()=>{var s,a;const i={type:r,merge:n,cleanFilteredInlineElements:null!==(s=o.cleanFilteredInlineElements)&&void 0!==s?s:[],indentUseMargin:null!==(a=o.indentUseMargin)&&void 0!==a&&a};return((e,t,n,r)=>{$i(n);const o=Kn(n),s=((e,t)=>{const n=t.merge,r=((e,t)=>{const n=t.browser.isFirefox(),r=xo([(s=n?fs:gs,a=!n,To(((e,t)=>{const n=((e,t,n)=>t(Ce.fromDom(e.getNode())).fold((()=>[e]),(t=>{const r=e.type()===lo,o=[uo(t.dom,r)];return!r&&n&&o.push(uo(t.dom,!0)),o})))(t,s,a);e.emitTokens(n)}),f))]),o=n?f:ra;var s,a;return{annotate:[e.type===hs.Word?r:f],local:[o]}})(t,e);return j([r.local,Pa(t),Fa(t),r.annotate,(o=n?[]:t.cleanFilteredInlineElements,[Sa,Ea,ua(o)]),Ma(t),Ha(t,e),[Ls],[da],[Xs],[Ys],Ra(t),[va,ya,oa,ba],[sa],[aa],[ia],[ga],Ua(t),[ha],[ca],[wa],za(t),[pa],[Zs]]);var o})(t,r);return wo(e,o,s)})(e,Sm,t,i)})),km=(e,t)=>{const n=Om((()=>((e,t)=>((e,t)=>wo(e,t,[Ys,ba]))(e,Kn(t)))(e,t)));return Em(n)},Dm=(e,t,n,r,o)=>Nm(e,t,r,n,o).fold(zr,(e=>Promise.resolve({response:Rr(e,[]),bundle:Hr({})}))),Am=e=>"\n"===e||"\r"===e,Cm=(e,t)=>{const n=(e=>{const t=Ce.fromTag("div");return((e,t)=>{e.dom.textContent=t})(t,e),Kn(t)})(e),r=((e,t)=>{const n=((e,t)=>{const n=e.replace(/\t/g,(r=t)<=0?"":new Array(r+1).join(" "));var r;const o=P(n,((e,t)=>(e=>-1!==" \f\t\v".indexOf(e))(t)||"\xa0"===t?e.pcIsSpace||""===e.str||e.str.length===n.length-1||((e,t)=>t<e.length&&t>=0&&Am(e[t]))(n,e.str.length+1)?{pcIsSpace:!1,str:e.str+"\xa0"}:{pcIsSpace:!0,str:e.str+" "}:{pcIsSpace:Am(t),str:e.str+t}),{pcIsSpace:!1,str:""});return o.str})(e,t).replace(/^[\r\n]*|[\r\n]*$/g,"").split(/(?:\r?\n){2}/),r=C(n,(e=>e.split(/\n|\r\n/).join("<br />")));return 1===r.length?r[0]:C(r,(e=>"<p>"+e+"</p>")).join("")})(n,t),o=qn(r);return Rr(o,[])},Lm=e=>(t,n)=>((e,t)=>{const n=lc(e).getOrDie("Required text input for Text Handler");return{response:n.text.length>0?Cm(n.text,t):Pr(),bundle:Hr({})}})(t,e),_m=(e,t)=>{const n=(e,n)=>{const r=Ce.fromTag("div");gn(r,e),$i(r);const o=zt(r);return{response:Rr(o,n),bundle:t.bundle}},r=v(t);return Lr(t.response,r,n,r,n)},Rm=(e,t,n)=>(r,o)=>{const s=sc(r).getOrDie("Wrong input type for HTML handler").container,a=Rt(t),i=o.bundle;return nm(i)?km(a,s):(e(s),((e,t,n,r,o)=>{const s=Nm(e,t,n,r,o);return Em(s)})(a,s,Jc(i),rm(i),n))},Pm=(e,t,n)=>(r,o)=>{const s=o.bundle;return(e=>({handle:(t,n)=>e.proxyBin.fold((()=>(console.error(t),Promise.resolve({response:Pr(),bundle:Hr({})}))),n)}))(s).handle("There was no proxy bin setup. Ensure you have run proxyStep first.",(r=>{const o=Jc(s),a=rm(s),i=nm(s),l=Rt(e);return i?((e,t,n,r)=>{const o=hs.Html,s=t.findClipboardTags(zt(n)).getOr([]);return L(s,hn),Dm(e,n,o,!0,r)})(l,t,r,n):((e,t,n,r,o)=>Dm(e,t,r,n,o))(l,r,o,a,n)}))},Mm=(e,t)=>(n,r)=>{const o=ic(n).getOrDie("Wrong input type for Word Import handler"),s=Qc(r.bundle);return Im(o,s,e,t)},Fm=(e,t)=>Br,jm=e=>(t,n)=>{const r=jr(n.bundle,Hr(e));return{response:n.response,bundle:r}},Hm=(e,t)=>(e=>{const t=e=>({response:Rr([e],[]),bundle:Hr({})});return(e=>(e=>{const t=Kt(e,"img");return Promise.all(C(t,hi)).then((()=>e))})(e))(e).then(t).catch((()=>t(e)))})(sc(e).getOrDie("Wrong input type for HTML handler").container),Um=v(om("smartpaste-eph-bin")),zm=lt();var Bm=(e,t,n,r)=>(o,s)=>{const a=s.response;return new Promise(((o,s)=>{const i=e(n);i.events.after.bind((e=>{const n=e.container;if(zm.browser.isSafari()&&(i=n,l='img[src^="webkit-fake-url"]',((e,t)=>{const n=void 0===t?document:t.dom;return St(n)?O.none():O.from(n.querySelector(e)).map(Ce.fromDom)})(l,i)).isSome()){const e=zm.deviceType.isWebView()?"webview.imagepaste":"safari.imagepaste";o({response:_r(e),bundle:Hr({})})}else{t(n),Cn(n,Um());const e=(s=Kn(n)).indexOf("<o:p>")>=0||s.indexOf("mso-list")>=0||s.indexOf("p.MsoNormal, li.MsoNormal, div.MsoNormal")>=0||s.indexOf("MsoListParagraphCxSpFirst")>=0||s.indexOf("<w:WordDocument>")>=0,i=((e,t)=>{const n=Kt(t,"*[id]");return A(n,(e=>On(e,"id").exists((e=>de(e,"docs-internal-guid-")))))})(0,n),l=zt(n),c=r.findClipboardTags(l).isSome();o({response:a,bundle:Hr({isWord:e,isGoogleDocs:i,isInternal:c,proxyBin:n})})}var s,i,l})),i.run()}))};const Wm=At([{unsupported:["id","message","isEquation","attrs"]},{supported:["id","contentType","blob","isEquation","attrs"]}]),$m={unsupported:Wm.unsupported,supported:Wm.supported,cata:(e,t,n)=>e.fold(t,n)},Gm=(e,t,n)=>t.indexOf(e,n),Vm=(e,t,n,r,o,s,a)=>-1===e||-1===t?O.none():O.some({start:e,end:t,bower:n,regex:r,idRef:o,isEquation:s,attrs:a}),qm=(e,t,n)=>e.substring(t,n),Km=(e,t)=>{if(-1===t)return t;let n=0;const r=e.length;do{const o=e.indexOf("{",t),s=e.indexOf("}",t);if(s>o&&-1!==o?(t=o+1,++n):(o>s||o<0)&&-1!==s&&(t=s+1,--n),t>r||-1===s)return-1}while(n>0);return t},Xm=(e,t,n,r,o)=>{const s=qm(e,n,r),a=((e,t)=>{const n=Gm("\\picscalex",e,t),r=Gm("\\bliptag",e,n);return n>-1&&n<r?O.from(e.substring(n,r)):O.none()})(e,n);return Vm(n,r,s,/[^a-fA-F0-9]([a-fA-F0-9]+)\}$/,"i",o,a)},Ym=(e,t,n,r,o)=>{const s=qm(e,n,r);return Vm(n,r,s,/([a-fA-F0-9]{64,})(?:\}.*)/,"s",o,O.none())},Zm=(e,t)=>((e,t)=>{const n=Gm("{\\pict{",e,t),r=Km(e,n),o=Gm("{\\shp{",e,t),s=Km(e,o),a=Gm("{\\mmathPict{",e,t),i=Km(e,a),l=-1!==a&&(a<n&&i>r||a<o&&i>s),c=x(Ym,e,t,o,s,l),m=x(Xm,e,t,n,r,l);return-1===n&&-1===o?O.none():-1===n?c():-1===o||o<n&&s>r?m():n<o&&r>s?c():n<o?m():o<n?c():O.none()})(e,t),Jm=e=>{let t=[];const n=()=>e.length,r=e=>{const n=(e=>{const t=e.bower,n=e.regex,r=e.isEquation,o=e.attrs;return(e=>{const t=/\\shplid(\d+)/.exec(e);return null!==t?O.some(t[1]):O.none()})(t).map((s=>{const a=e.idRef+s;return(e=>e.indexOf("\\pngblip")>=0?Tr.value("image/png"):e.indexOf("\\jpegblip")>=0?Tr.value("image/jpeg"):Tr.error("errors.imageimport.unsupported"))(t).fold((e=>$m.unsupported(a,e,r,o)),(e=>((e,t)=>{const n=e.match(t);return n&&n[1]&&n[1].length%2==0?Tr.value(n[1]):Tr.error("errors.imageimport.invalid")})(t,n).fold((e=>$m.unsupported(a,e,r,o)),(t=>$m.supported(a,e,((e,t)=>{if(0===e.length)throw new Error("Zero length content passed to Hex conversion");const n=(e=>{const t=new Array(e.length/2);for(let n=0;n<e.length;n+=2){const r=e.substr(n,2);t[Math.floor(n/2)]=parseInt(r,16)}return t})(e),r=new Uint8Array(n);return new Blob([r],{type:t})})(t,e),r,o)))))}))})(e);return t=t.concat(n.toArray()),e.end};let o=0;for(;o<e.length;)o=Zm(e,o).fold(n,r);return t},Qm=e=>$m.cata(e,((e,t,n)=>e),((e,t,n,r,o)=>e)),ed=e=>$m.cata(e,((e,t,n)=>n),((e,t,n,r,o)=>r)),td=e=>$m.cata(e,((e,t,n)=>Tr.error(t)),((e,t,n,r,o)=>Tr.value(n))),nd=(e,t)=>{const n=new RegExp("\\\\pic"+t+"(\\-?\\d+)\\\\").exec(e)[1];return parseInt(n,10)},rd=(e,t,n,r,o)=>{const s=[],a=[];let i=!1;return{blobs:H(e,((e,l)=>{const c=Sn(e,"data-image-id");return Nn(e,"rtf-data-image"),Nn(e,"data-image-id"),Nn(e,"data-ms-equation"),o||Nn(e,"data-image-src"),"unsupported"===c?(i=!0,Tn(e,"alt",n("errors.imageimport.unsupported")),[]):M(t,((e,t)=>r(e,t,c,l))).fold((()=>(console.log("WARNING: unable to find data for image ",e.dom),i=!0,Tn(e,"alt",n("errors.imageimport.unsupported")),[])),(t=>td(t).fold((t=>(i=!0,console.error("PowerPaste error code: RTF04"),Tn(e,"alt",n(t)),[])),(n=>{var r;return s.push(e),a.push((r=t,$m.cata(r,((e,t,n)=>O.none()),((e,t,n,r,o)=>o)))),o&&Nn(e,"data-image-src"),[n]}))))})),filteredImages:s,imageAttrs:a,failedImage:i}},od=(e,t,n,r,o)=>{const s=(e=>P(e,((e,t)=>{const n=Qm(t),r=ed(t);return F(e,(e=>!(r||ed(e))&&Qm(e)===n)).fold((()=>e.concat([t])),(n=>td(e[n]).isValue()?e:e.slice(0,n).concat(e.slice(n+1)).concat([t])))}),[]))(t),a=o.keepSrc||!1,{pass:i,fail:l}=_(s,(e=>!ed(e))),{pass:c,fail:m}=_(e,(e=>!(e=>"true"===Sn(e,"data-ms-equation"))(e))),d=rd(c,i,r,((e,t,n,r)=>Qm(e)===n),a),u=rd(m,l,r,((e,t,n,r)=>t===r),a),p=d.filteredImages.concat(u.filteredImages),g=d.imageAttrs.concat(u.imageAttrs),f=d.blobs.concat(u.blobs),h=d.failedImage||u.failedImage;Ec(f).get((e=>{((e,t)=>e.length===t.length?Promise.all(C(e,((e,n)=>((e,t)=>t.fold((()=>Promise.resolve(e)),(t=>Ic.cata(e,((n,r,o)=>r.toCanvas().then((s=>{const a=Ce.fromDom(s),i=On(a,"width").map((e=>parseInt(e,10))).getOr(1),l=On(a,"height").map((e=>parseInt(e,10))).getOr(1),c=((e,t,n)=>{const r=x(nd,e),o=r("wgoal"),s=r("hgoal"),a=o/t,i=s/n,l=r("cropl"),c=r("cropt");return{cropl:l/a,cropt:c/i,cropw:(o-l-r("cropr"))/a,croph:(s-c-r("cropb"))/i}})(t,i,l);return i===c.cropw&&l===c.croph&&0===c.cropl&&0===c.cropt?Promise.resolve(e):ai(r,c.cropl,c.cropt,c.cropw,c.croph).then((e=>e.toBlob().then((t=>{URL.revokeObjectURL(o);const r=URL.createObjectURL(t);return Ic.blob(n,e,r)}))))}))),((t,n,r)=>Promise.resolve(e))))))(e,t[n])))):Promise.resolve(e))(e,g).then((e=>{const t=Dc(e,p);n(t,h)}))}))},sd=e=>Kt(e,"[rtf-data-image]"),ad=e=>{const t=e.translations,n=Tt({insert:pt(["elements","correlated"]),incomplete:pt(["elements","correlated","message"])});return{events:n.registry,processRtf:(e,r,o,s)=>{const a=(e=>{const t=e.replace(/\r/g,"").replace(/\n/g,"");return Jm(t)})(o),i=sd(e);od(i,a,((t,o)=>{const s=zt(e),a=t.concat(r);o?(console.error("PowerPaste error code: RTF01"),n.trigger.incomplete(s,a,"errors.imageimport.failed")):n.trigger.insert(s,a)}),t,s)}}};const id=e=>{const t=()=>Promise.resolve(e);return Ic.cata(e.asset,((n,r,o)=>/tiff$/.test(r.getType())?(e=>((e,t,n)=>e.toAdjustedBlob(t,n))(e,"image/png").then((e=>Sc(e).toPromise())).then(O.some).catch((e=>(console.warn(e),O.none()))))(r).then((t=>t.map((t=>{const n=e.image;return URL.revokeObjectURL(o),kc(t,n),Nc(t,n)})).getOr(e))):t()),t)};var ld=(e,t)=>{const n=(e,n)=>Promise.all(C(e,id)).then((e=>({response:n(e),bundle:t.bundle})));return Lr(t.response,zr,((e,t)=>n(t,(t=>Rr(e,t)))),(()=>Promise.resolve(t)),((e,t,r)=>n(t,(t=>(console.error("PowerPaste error code:  IMG01"),Mr(e,t,r))))))};const cd=(e,t)=>e.isSupported?t.getWordData():O.none(),md=e=>e.getNative(),dd=e=>e.getImage(),ud=e=>e.getHtml(),pd=e=>e.getText(),gd=e=>e.getOnlyText(),fd=e=>e.getGoogleDocsData(),hd=e=>e.getVoid(),vd=(e,t,n,r)=>({label:e,getAvailable:t,steps:n,capture:v(r)}),yd=(e,t,n,r)=>({label:e,getAvailable:t,steps:n,capture:v(r)}),bd=(e,t,n,r)=>{return vd(bc.native,ud,[(o=t.intraFlag,(e,t)=>{const n=sc(e).getOrDie("Wrong input type for HTML handler"),r=o.findClipboardTags(zt(n.container));r.each((e=>{L(e,hn)}));const s=r.isSome();return{response:t.response,bundle:Hr({isInternal:s})}}),am(e,t),Rm(n,r,t),jc(t),ld],!0);var o},xd=(e,t,n)=>{return vd(bc.msoffice,x(cd,e),[jm({isWord:!0}),sm(t,n),Mm(e,n),(r=n,(e,t)=>new Promise(((n,o)=>{const s=ad(r),a=e=>n({response:e,bundle:Hr({})});s.events.insert.bind((e=>{a(Rr(e.elements,e.correlated))})),s.events.incomplete.bind((e=>{console.error("PowerPaste error code: RTF02"),a(Mr(e.elements,e.correlated,e.message))}));const i=ic(e).getOrDie("Word input required for rtf data"),l=e=>{const n=()=>Promise.resolve(t),o=(t,n)=>{const o=Ce.fromTag("div");return gn(o,t),e.fold((()=>{const e=sd(o);return e.length>0?(e=>{L(e,hn);const t=zt(o);return console.error("PowerPaste error code: RTF03"),a(Mr(t,n,"errors.imageimport.failed"))})(e):(()=>{const e=zt(o);return a(Rr(e,n))})()}),(e=>{s.processRtf(o,n,e,r)}))};return Lr(t.response,n,o,n,o)};((e,t)=>{const n=gt(t);if(n.length!==Vi.length)throw new Error("Partial match");W(n,(n=>Pn(e.discriminator===n,t[n]))).getOrDie("Must find branch for constructor: "+e.discriminator)(e.data)})(i.rtf,{disabled:()=>{l(O.none())},fromClipboard:e=>{l(!0===r.allowLocalImages?O.some(e.rtf):O.none())}})}))),ld],!0);var r},wd=(e,t,n,r)=>vd(bc.googledocs,fd,[jm({isGoogleDocs:!0}),sm(e,t),Hm,Rm(n,r,t),Zc,jc(t),ld],!0),Td=e=>{const t=O.from(e.tabSpaces).getOr(4);return vd(bc.plaintext,gd,[Lm(t),_m],!0)},Id=(e=4)=>vd(bc.text,pd,[Lm(e),_m],!0),Sd=(e,t,n,r,o=Ar)=>{const s=ut(o,r.baseUrl,r.cacheSuffix),a=ur(void 0!==r.pasteBinAttrs?r.pasteBinAttrs:{}),i=void 0===r.sanitizer?Xl(r.intraFlag.isMarked):r.sanitizer,l=[Td(r),xd(s,t,r),wd(t,r,n,e),bd(t,r,n,e),(c=r,vd(bc.image,dd,[!1===c.allowLocalImages?(e,t)=>zr("errors.local.images.disallowed"):(e,t)=>(e=>{const t=R(e,(e=>"file"===e.kind&&/image/.test(e.type))),n=P(t,((e,t)=>{const n=t.getAsFile();return(e=>null!==e)(n)?e.concat(n):e}),[]);return Ec(n).toPromise().then((e=>({response:(e=>{const t=[],n=[];return L(e,(e=>Ic.cata(e,((r,o,s)=>{const a=Ce.fromTag("img");Tn(a,"src",s),t.push(a),n.push(Nc(e,a))}),((e,t,n)=>{console.error("Internal error: Paste operation produced an image URL instead of a Data URI: ",t)})))),Rr(t,n)})(e),bundle:Hr({})})))})(ac(e).getOrDie("Must have image data for images handler").images),ld],!0)),Id(r.tabSpaces)];var c;const m=((e,t,n,r,o)=>yd(bc.fallback,md,[Bm(r,n,o,t.intraFlag),am(e,t),Pm(o,t.intraFlag,t),jc(t),ld],!1))(t,r,n,a,e);return wc(l,m,i)};var Od=Object.freeze({__proto__:null,loadScript:(e,t)=>tinymce.Resource.load(e,t)});const Ed={"cement.dialog.paste.title":"Paste Formatting Options","cement.dialog.paste.instructions":"Choose to keep or remove formatting in the pasted content.","cement.dialog.paste.merge":"Keep formatting","cement.dialog.paste.clean":"Remove formatting","safari.imagepaste":'Safari does not support direct paste of images. <a href="https://support.ephox.com/entries/88543243-Safari-Direct-paste-of-images-does-not-work" style="text-decoration: underline">More information on image pasting for Safari</a>',"webview.imagepaste":'Safari does not support direct paste of images. <a href="https://support.ephox.com/entries/88543243-Safari-Direct-paste-of-images-does-not-work" style="text-decoration: underline">More information on image pasting for Safari</a>',"error.code.images.not.found":"The images service was not found: (","error.imageupload":"Image failed to upload: (","error.full.stop":").","errors.local.images.disallowed":"Local image paste has been disabled. Local images have been removed from pasted content.","errors.imageimport.failed":"Some images failed to import.","errors.imageimport.unsupported":"Unsupported image type.","errors.imageimport.invalid":"Image is invalid."},Nd=e=>tinymce.translate((e=>Ed[e])(e)),kd=e=>{const t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},Dd=v("x-tinymce/html"),Ad="\x3c!-- x-tinymce/html --\x3e",Cd=e=>-1!==e.indexOf(Ad),Ld=e=>/^https?:\/\/[\w\?\-\/+=.&%@~#]+$/i.test(e),_d=e=>{const t=/^<a href="([^"]+)">([^<]+)<\/a>$/.exec(e);return O.from(t).bind((t=>{const n={url:t[1],html:e};return Pn(t[1]===t[2],n)}))},Rd=(e,t,n)=>(e=>"extra"in e.undoManager)(e)?(e.undoManager.extra((()=>{Fd(e,t)}),n),O.some(!0)):O.none(),Pd=(e,t)=>_d(t).bind((t=>!1===e.selection.isCollapsed()&&Ld(t.url)?((e,t)=>Rd(e,t.html,(()=>{e.execCommand("mceInsertLink",!1,t.url)})))(e,t):O.none())),Md=(e,t)=>_d(t).bind((t=>((e,t)=>{const n=e.toLowerCase();return Ld(n)&&A(t,(e=>ue(n,`.${e.toLowerCase()}`)))})(t.url,se(e))?((e,t)=>Rd(e,t.html,(()=>{e.insertContent('<img src="'+t.url+'">')})))(e,t):O.none())),Fd=(e,t)=>(e.insertContent(t,{merge:V(e),paste:!0}),O.some(!0)),jd=(e,t)=>e.hasEventListeners(t),Hd=(e,t,n,r,o)=>{const s=(e=>e.replace(Ad,""))(t);return((e,t,n,r,o)=>jd(e,"PastePostProcess")?((e,t,n,r,o)=>{const s=e.dom.add(e.getBody(),"div",{style:"display:none"},t),a=((e,t)=>e.dispatch("PastePostProcess",t))(e,{internal:n,node:s,source:r,mode:o}).node.innerHTML;return e.dom.remove(s),a})(e,t,n,r,o):t)(e,((e,t,n,r,o)=>jd(e,"PastePreProcess")?((e,t,n,r,o)=>((e,t)=>e.dispatch("PastePreProcess",t))(e,{internal:n,content:t,source:r,mode:o}).content)(e,t,n,r,o):t)(e,s,n,r,o),n,r,o)},Ud=(e,t,n,r,o,s)=>{const a=ie(),i=("/js",(r?r.jsUrl:n).replace(/\/$/,"")+"/"+"/js".replace(/^\//,""));const l=(e,t)=>(e.undoManager.transact((()=>{var n;Fd(e,t),n=e.getBody(),L(C(n.getElementsByTagName("*"),Ce.fromDom),(e=>{En(e,"data-mce-style")&&!En(e,"style")&&On(e,"data-mce-style").each((t=>Tn(e,"style",t)))}))})),O.some(!0)),c=()=>{a.on((t=>e.selection.moveToBookmark(t))),a.clear()},m=q(e),d={baseUrl:i,cacheSuffix:X(e),officeStyles:te(e),htmlStyles:re(e),gdocsStyles:ne(e),translations:Nd,allowLocalImages:ee(e),pasteBinAttrs:{"data-mce-bogus":"all",class:"mce-pastebin"},intraFlag:{isMarked:Cd,findClipboardTags:e=>{const t=R(e,(e=>Te(e)&&me(De(e),Dd())));return t.length?O.some(t):O.none()}},keepSrc:Q(e),cleanFilteredInlineElements:oe(e),indentUseMargin:Z(e),sanitizer:o,tabSpaces:m},u=Sd(Ce.fromDom(e.getBody()),(e=>({createDialog:()=>{let t="";const n=ie(),r=(()=>{const e=ae([{text:"Close",name:"close",type:"custom",primary:!0}]),t=ae({});return{setButtons:n=>{const r={},o=C(n,(e=>{const t=e.text;return r[t.toLowerCase()]=e.click,{text:t,name:t.toLowerCase(),type:"custom"}}));t.set(r),e.set(o)},getButtons:e.get,getAction:e=>{const n=t.get();return wt(n,e)?O.some(n[e]):O.none()}}})(),o=Tt({close:pt([])}),s=()=>{o.trigger.close()};return{events:o.registry,setTitle:e=>t=e,setContent:e=>n.set(e),setButtons:e=>{r.setButtons(e)},show:()=>{n.on((n=>{const o=kd(n.dom),a={title:t,body:{type:"panel",items:[{type:"htmlpanel",html:o}]},initialData:{},buttons:r.getButtons(),onCancel:s,onAction:(e,t)=>{r.getAction(t.name).each(T),e.close()}};e.windowManager.open(a)}))},hide:f,destroy:()=>{n.clear()},reflow:f}}}))(e).createDialog,f,d,Od),p=((e=Yl,t)=>wc([Id(t)],yd(bc.discard,hd,[Fm],!0),e))(o,m);return L([u,p],(t=>{t.events.cancel.bind((()=>{c()})),t.events.error.bind((t=>{c(),e.notificationManager?e.notificationManager.open({text:Nd(t.message),type:"error"}):((e,t)=>{const n={title:"Error",body:{type:"panel",items:[{type:"htmlpanel",html:t}]},initialData:{},buttons:[{text:"OK",type:"cancel",name:"ok",primary:!0}]};e.windowManager.open(n)})(e,Nd(t.message))})),t.events.insert.bind((t=>{const n=C(t.elements,(e=>kd(e.dom))).join("");e.focus(),s.importImages(t.assets).get((()=>{c(),((e,t)=>{((e,t,n)=>{W(n,(n=>n(e,t)))})(e,t,(K(e)?[Pd,Md]:[]).concat([l]))})(e,Hd(e,n,t.isInternal,t.source,t.mode)),Y(e)&&s.uploadImages(t.assets)}))})),t.events.block.bind((t=>{e.setProgressState(t.state)}))})),{pasteHtml:e=>u.pasteCustom(((e,t=Yl)=>({getWordData:()=>O.from(e).filter(mc).map((e=>nc({html:e,rtf:qi()}))),getGoogleDocsData:()=>O.from(e).filter(dc).map((e=>t.sanitizeHtml(e,"googledocs"))).map(vc),getImage:O.none,getHtml:()=>O.some(vc(t.sanitizeHtml(e))),getText:O.none,getNative:w("There is no native event"),getOnlyText:O.none,getVoid:w("There is no paste event")}))(e,o)),pasteText:e=>p.pasteCustom(((e,t=Yl)=>({getWordData:O.none,getGoogleDocsData:O.none,getImage:O.none,getHtml:O.none,getText:()=>O.some(rc({text:t.sanitizeText(e)})),getNative:w("There is no native event"),getOnlyText:O.none,getVoid:w("There is no paste event")}))(e,o)),pasteEvent:n=>{(e=>{return(t=e,O.from(t.clipboardData).bind((e=>O.from(e.getData("text/html"))))).bind((e=>(e=>me(e,"<google-sheets-html-origin"))(e)?O.some("googlesheets"):(e=>me(e," data-ccp-props=")&&me(e," paraid=")&&/font-family:.+?_MSFontService(&quot;)?[,;]/.test(e))(e)?O.some("mswordonline"):(e=>me(e,"<meta name=ProgId content=Excel.Sheet>")&&!me(e,'="urn:schemas-microsoft-com:office:'))(e)?O.some("msexcelonline"):O.none()));var t})(n).each((t=>{((e,t)=>{e.dispatch("PowerPasteTempStats",{source:t})})(e,t)})),a.isSet()||a.set(e.selection.getBookmark(1)),(t.isText()?p:u).paste(n),t.reset()}}},zd=(e,t)=>{const n=tinymce.html.DomParser({},e.schema).parse(t,{forced_root_block:!1,isRootContent:!0});return tinymce.html.Serializer({validate:!0},e.schema).serialize(n)},Bd=(e,t)=>{e.dom.bind(t,"drop dragstart dragend dragover dragenter dragleave dragdrop draggesture",(e=>{e.preventDefault(),e.stopImmediatePropagation()}))},Wd=(e,t,n,r)=>{const o=tinymce.dom.RangeUtils;let s;const a=t=>{var n,r;const s=o.getCaretRangeFromPoint(null!==(n=t.clientX)&&void 0!==n?n:0,null!==(r=t.clientY)&&void 0!==r?r:0,e.getDoc());e.focus(),u(s)&&e.selection.setRng(s)};e.on("dragstart dragend",(e=>{s="dragstart"===e.type})),e.on("dragover dragend dragleave",(e=>{s||(e.preventDefault(),a(e))}));const i=(e,t)=>t in e&&e[t].length>0;e.on("drop",(t=>{if(!s){a(t);const o=(t=>{var n,r,o;const s=null!==(o=null!==(n=t.target.files)&&void 0!==n?n:null===(r=t.dataTransfer)||void 0===r?void 0:r.files)&&void 0!==o?o:[],a=se(e);return R(s,(e=>de(e.type,"image/")&&A(a,(t=>(e=>{const t=e.toLowerCase(),n={jpg:"jpeg",jpe:"jpeg",jfi:"jpeg",jif:"jpeg",jfif:"jpeg",pjpeg:"jpeg",pjp:"jpeg",svg:"svg+xml"};return wt(n,t)?"image/"+n[t]:"image/"+t})(t)===e.type))))})(t);if(o.length>0)return(t=>{Ec(t).get((t=>{const n=(e=>C(e,(e=>{const t=Ce.fromTag("img"),n=Ic.cata(e,r.getLocalURL,((e,t,n)=>t));return Tn(t,"src",n),t.dom.outerHTML})).join(""))(t);e.insertContent(Hd(e,n,!1,"imagedrop","auto"),{merge:V(e)}),Y(e)&&r.uploadImages(t)}))})(o),void t.preventDefault();const s=(e=>{const t={};if(e&&e.types)for(let n=0;n<e.types.length;n++){const r=e.types[n];t[r]=e.getData(r)}return t})(t.dataTransfer);i(s,"text/html")?(n.pasteHtml(s["text/html"]),t.preventDefault()):i(s,"text/plain")&&!(e=>{const t=e["text/plain"];return!!t&&0===t.indexOf("file://")})(s)&&(n.pasteText(s["text/plain"]),t.preventDefault())}}))};tinymce.PluginManager.requireLangPack("powerpaste","ar,bg_BG,ca,cs,da,de,el,es,eu,fa,fi,fr_FR,he_IL,hi,hr,hu_HU,id,it,ja,kk,ko_KR,ms,nb_NO,nl,pl,pt_BR,pt_PT,ro,ru,sk,sl_SI,sv_SE,th_TH,tr,uk,vi,zh_CN,zh_TW"),tinymce.PluginManager.add("powerpaste",(e=>(n,o)=>{if(((e,n)=>!!e&&-1===((e,n)=>{const r=t(e.major,n.major);if(0!==r)return r;const o=t(e.minor,n.minor);if(0!==o)return o;const s=t(e.patch,n.patch);return 0!==s?s:0})((e=>r((e=>[e.majorVersion,e.minorVersion].join(".").split(".").slice(0,3).join("."))(e)))(e),r(n)))(tinymce,"6.0.0"))return void console.error('The "powerpaste" plugin requires at least version 6.0.0 of TinyMCE.');(e=>{const t=e.options.register,n=e=>{const t=p(e)||(e=>a(e)&&D(["clean","merge","prompt"],e))(e);return t?{value:e,valid:t}:{valid:!1,message:"Must be prompt, clean or merge."}};t("powerpaste_block_drop",{processor:"boolean",default:!1}),t("powerpaste_keep_unsupported_src",{processor:"boolean",default:!1}),t("powerpaste_allow_local_images",{processor:"boolean",default:!0}),t("powerpaste_word_import",{processor:n,default:"prompt"}),t("powerpaste_googledocs_import",{processor:n,default:"prompt"}),t("powerpaste_html_import",{processor:n,default:"clean"}),t("powerpaste_clean_filtered_inline_elements",{processor:"string[]",default:[]})})(n),(e=>{const t=e.options.set;t("paste_block_drop",!1),t("paste_data_images",!1),t("paste_remove_styles_if_webkit",!1)})(n);const s=(e=>{const t=ae(G(e)),n=ae(!1);return e.on("keydown",(e=>{(e=>tinymce.util.VK.metaKeyPressed(e)&&86===e.keyCode&&e.shiftKey)(e)&&n.set(!0)})),e.on("PastePlainTextToggle",(e=>{t.set(e.state)})),{reset:()=>{n.set(!1)},isText:()=>n.get()||t.get()}})(n),i=(e=>{const t=(e,t)=>v(e+"."+(e=>{const t=e.toLowerCase(),n={"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png","image/apng":"apng","image/avif":"avif","image/svg+xml":"svg","image/webp":"webp","image/bmp":"bmp","image/tiff":"tiff"};return wt(n,t)?n[t]:"dat"})(t)),n=(n,r,o,s)=>vr((a=>{mi(r).then((r=>{e.editorUpload.blobCache.add({id:v(n),name:v(n),filename:t(n,r.type),blob:v(r),base64:v(o.split(",")[1]),blobUri:v(s),uri:v(void 0)}),a(r)}))}));return{importImages:e=>{const t=H(e,(e=>Ic.cata(e,((e,t,r)=>{const o=di(t);return[n(e,t,o,r)]}),v([]))));return yr(t)},uploadImages:()=>{e.uploadImages()},getLocalURL:(e,t,n)=>di(t)}})(n),l=(e=>{const t=Xl(Cd),n=(e=>({sanitizeHtml:x(zd,e),sanitizeText:y}))(e);return{sanitizeText:t.sanitizeText,sanitizeHtml:(e,r)=>(Cd(e)?n:t).sanitizeHtml(e,r)}})(n);n.on("PreInit",(()=>{if(n.removed)return;const t=Ud(n,s,o,e,l,i);((e,t)=>{e.addCommand("mceInsertClipboardContent",((e,n)=>{a(n.html)?t.pasteHtml(n.html):a(n.text)&&t.pasteText(n.text)}))})(n,t),((e,t)=>{e.on("paste",(e=>{e.isDefaultPrevented()||(t.pasteEvent(e),e.stopImmediatePropagation())}))})(n,t),J(n)?(e=>{Bd(e,e.getBody()),e.inline||Bd(e,e.getDoc())})(n):Wd(n,0,t,i)}))})(undefined))}();
