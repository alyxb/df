

<!DOCTYPE html>



<html style="background-color:black;">
	<head>
		<title>deep feed revive</title>
		
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.150.1/build/three.module.js"
        }
      }
      //https://unpkg.com/three@0.150.1/build/three.module.js
    </script>
    
    <script type="module">

// webglMetallicFoilShimmer.js

import * as THREE from 'three';
	    
import { FontLoader } from './FontLoader.js';
	    
	    class WebGLDonutShimmer {
  constructor(container) {
    this.container = container;

    this.initScene();
  }

  initScene() {
	  

	  
    this.scene = new THREE.Scene();
    this.camera = new THREE.PerspectiveCamera(75, this.container.offsetWidth / this.container.offsetHeight, 0.1, 1000);

    this.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    this.renderer.setSize(this.container.offsetWidth, this.container.offsetHeight);
    this.container.appendChild(this.renderer.domElement);

    const light = new THREE.PointLight(0xffffff, 1, 100);
    light.position.set(10, 10, 10);
    this.scene.add(light);

    const ambientLight = new THREE.AmbientLight(0x404040);
    this.scene.add(ambientLight);

    const material = new THREE.MeshStandardMaterial({ color: 0x9ca6af, metalness: 0.9, roughness: 0.3 });

    // Create a donut shape using TorusGeometry
    const geometry = new THREE.TorusGeometry(1, 0.4, 16, 100);
    this.donutMesh = new THREE.Mesh(geometry, material);
    this.scene.add(this.donutMesh);

    this.camera.position.z = 5;

    this.initSensors();
    this.animate();
	  
	  
const lightPositions = this.calculateLightPositions();

const sunLight = new THREE.PointLight(0xffffff, 1, 100);
sunLight.position.set(lightPositions.sunPosition.x, lightPositions.sunPosition.y, lightPositions.sunPosition.z);
this.scene.add(sunLight);

const moonLight = new THREE.PointLight(0x555555, 0.5, 100);
moonLight.position.set(lightPositions.moonPosition.x, lightPositions.moonPosition.y, lightPositions.moonPosition.z);
this.scene.add(moonLight);
	  
	  
	  const bumpTextureLoader = new THREE.TextureLoader();
		const bumpTexture = bumpTextureLoader.load('https://www.paulsprojects.net/tutorials/simplebump/normal.jpg');
		this.donutMaterial.bumpMap = bumpTexture;
		this.donutMaterial.bumpScale = 0.1;
  }
		    
		    
calculateLightPositions() {
  const now = new Date();
  const hours = now.getHours() + now.getMinutes() / 60;

  // Assuming a simple sun movement between sunrise (6 AM) and sunset (6 PM)
  const sunRise = 6;
  const sunSet = 18;

  let sunProgress, moonProgress;
  if (hours < sunRise) {
    sunProgress = 0;
    moonProgress = 1 - hours / sunRise;
  } else if (hours > sunSet) {
    sunProgress = 1;
    moonProgress = (hours - sunSet) / (24 - sunSet);
  } else {
    sunProgress = (hours - sunRise) / (sunSet - sunRise);
    moonProgress = 0;
  }

  // Set the light's y position based on the sun's and moon's progress
  const sunLightY = sunProgress * 10;
  const moonLightY = moonProgress * 5;

  return {
    sunPosition: new THREE.Vector3(0, sunLightY, 5),
    moonPosition: new THREE.Vector3(0, moonLightY, -5)
  };
}

initSensors() {
  // Accelerometer
  if ('Accelerometer' in window) {
    this.requestSensorPermission('accelerometer')
      .then(() => {
        const accelerometer = new Accelerometer({ frequency: 60 });
        accelerometer.addEventListener('reading', () => {
          // Donut will stay still
        });
        accelerometer.start();
      })
      .catch((error) => {
        console.error('Accelerometer permission denied:', error);
      });
  }

  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

  if (!isIOS && 'AmbientLightSensor' in window) {
    this.requestSensorPermission('ambient-light-sensor')
      .then(() => {
        const ambientLightSensor = new AmbientLightSensor();
        ambientLightSensor.addEventListener('reading', () => {
          const lightIntensity = ambientLightSensor.illuminance / 500;
          this.scene.children.forEach((child) => {
            if (child.type === 'PointLight') {
              child.intensity = lightIntensity;
            }
          });
        });
        ambientLightSensor.start();
      })
      .catch((error) => {
        console.error('AmbientLightSensor permission denied:', error);
        // Fallback to DeviceOrientationEvent
        this.initDeviceOrientationLight();
      });
  } else {
    // Use DeviceOrientationEvent for iOS devices and devices that don't support AmbientLightSensor
    this.initDeviceOrientationLight();
  }
}
		    

initDeviceOrientationLight() {
  window.addEventListener('deviceorientation', (event) => {
    const beta = event.beta; // Range: -180 to 180
    const gamma = event.gamma; // Range: -90 to 90

    const intensity = (Math.abs(beta) + Math.abs(gamma)) / (180 + 90); // Normalize intensity to a range of 0 to 1
    const lightIntensity = intensity * 2; // Adjust the maximum light intensity value (higher value means brighter)

    this.scene.children.forEach((child) => {
      if (child.type === 'PointLight') {
        child.intensity = lightIntensity;
      }
    });
  });
}
		    
		    

// requestSensorPermission(sensorType) {
//   return new Promise((resolve, reject) => {
//     if (typeof DeviceMotionEvent.requestPermission === 'function') {
//       DeviceMotionEvent.requestPermission()
//         .then((permissionState) => {
//           if (permissionState === 'granted') {
//             resolve();
//           } else {
//             reject(new Error(`${sensorType} permission not granted`));
//           }
//         })
//         .catch((error) => {
//           reject(error);
//         });
//     } else {
//       resolve();
//     }
//   });
// }
		    
requestSensorPermission(sensorType) {
  return new Promise((resolve, reject) => {
    if (
      sensorType === 'ambient-light-sensor' &&
      typeof navigator.permissions !== 'undefined' &&
      typeof navigator.permissions.query === 'function'
    ) {
      navigator.permissions
        .query({ name: 'ambient-light-sensor' })
        .then((result) => {
          if (result.state === 'granted') {
            resolve();
          } else {
            reject(new Error(`${sensorType} permission not granted`));
          }
        })
        .catch((error) => {
          reject(error);
        });
    } else if (
      sensorType === 'accelerometer' &&
      typeof DeviceMotionEvent.requestPermission === 'function'
    ) {
      DeviceMotionEvent.requestPermission()
        .then((permissionState) => {
          if (permissionState === 'granted') {
            resolve();
          } else {
            reject(new Error(`${sensorType} permission not granted`));
          }
        })
        .catch((error) => {
          reject(error);
        });
    } else {
      resolve();
    }
  });
}		    
		    
  animate() {
    requestAnimationFrame(this.animate.bind(this));

    this.renderer.render(this.scene, this.camera);
  }
}

// Usage
document.addEventListener('DOMContentLoaded', function () {
  const container = document.getElementById('your-container-id');
  const webglDonutShimmer = new WebGLDonutShimmer(container);
});

    </script>
    
    
    
    
	</head>
	<body style="display: flex;">
		
		<div id="your-container-id"></div>
    
	</body>
	
	<style>
		#your-container-id {
  width: 100%;
  height: 100vh;
  position: relative;
}
	</style>
</html>
